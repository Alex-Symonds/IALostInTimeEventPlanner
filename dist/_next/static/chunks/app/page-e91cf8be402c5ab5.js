(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6435:function(e,t,n){Promise.resolve().then(n.bind(n,5530))},5530:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var l,i,r,s,a=n(7437),o=n(6691),u=n.n(o),d=n(2265);let c="border-blue-950 bg-blue-950 text-rose-400",p={mainAsBg:"bg-neutral-100",mainAsBorder:"border-neutral-100",borderOnMain:"border-neutral-200",emptyBg:"bg-neutral-400",plannerHeaderFooterBgAndText:"bg-neutral-600 text-white",headingBgAndText:"bg-neutral-500 text-white",mainHeadingText:"text-violet-700",subtleTextOnBg:"text-neutral-800",panelBg:"bg-white",secondaryOnToolbar:"secondary"},g="top-[3.25rem]",m={blue:{badge:"bg-sky-700 text-white border-sky-800",hover:"hover:bg-sky-600 hover:opacity-100",cell:"bg-sky-50 border-sky-300",field:"border-sky-700 bg-sky-100"},green:{badge:"bg-green-700 text-white border-green-800",hover:"hover:bg-green-600 hover:opacity-100",cell:"bg-green-50 border-green-300",field:"border-green-700 bg-green-100"},red:{badge:"bg-red-700 text-white border-red-800",hover:"hover:bg-red-600 hover:opacity-100",cell:"bg-red-50 border-red-300",field:"border-red-700 bg-red-100"},yellow:{badge:"bg-amber-400 text-black font-bold border-amber-500",hover:"hover:bg-amber-300 hover:opacity-100",cell:"bg-amber-50 border-amber-300",field:"border-amber-500 bg-amber-100"},dust:{badge:"bg-lime-300 text-black font-bold border-lime-500",hover:"hover:bg-lime-200 text-black hover:opacity-100",cell:"bg-lime-50 border-lime-400 text-black",field:"border-lime-500 bg-lime-200"}};function nbsp(){return String.fromCharCode(160)}function toThousands(e){return e<1e3?e.toLocaleString():"".concat(Math.floor(e/1e3).toLocaleString(),"k")}function toBillions(e){return e<1e9?"<1B":"".concat(Math.floor(e/1e9).toLocaleString(),"B")}function capitalise(e){return"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1))}(l=r||(r={}))[l.active=0]="active",l[l.plan=1]="plan";var f=JSON.parse('{"trinity":{"name":"Trinity","type":"Worker","baseTime":"5","outputs":["blue","dust"],"upgrades":[{"level":"1","costs":[],"results":[{"outputType":"blue","quantity":"1"},{"outputType":"dust","quantity":"5"}]},{"level":"2","costs":[{"egg":"blue","quantity":"5"}],"results":[{"outputType":"blue","quantity":"2"},{"outputType":"dust","quantity":"10"}]},{"level":"3","costs":[{"egg":"blue","quantity":"50"}],"results":[{"outputType":"blue","quantity":"3"},{"outputType":"dust","quantity":"25"}]},{"level":"4","costs":[{"egg":"green","quantity":"50"}],"results":[{"outputType":"blue","quantity":"4"},{"outputType":"dust","quantity":"50"}]},{"level":"5","costs":[{"egg":"green","quantity":"150"},{"egg":"blue","quantity":"500"}],"results":[{"outputType":"blue","quantity":"5"},{"outputType":"dust","quantity":"100"}]},{"level":"6","costs":[{"egg":"blue","quantity":"4000"}],"results":[{"outputType":"blue","quantity":"6"},{"outputType":"dust","quantity":"250"}]},{"level":"7","costs":[{"egg":"green","quantity":"2500"}],"results":[{"outputType":"blue","quantity":"7"},{"outputType":"dust","quantity":"500"}]},{"level":"8","costs":[{"egg":"red","quantity":"500"},{"egg":"green","quantity":"3000"}],"results":[{"outputType":"blue","quantity":"8"},{"outputType":"dust","quantity":"1000"}]},{"level":"9","costs":[{"egg":"red","quantity":"1000"}],"results":[{"outputType":"blue","quantity":"9"},{"outputType":"dust","quantity":"2500"}]},{"level":"10","costs":[{"egg":"yellow","quantity":"250"}],"results":[{"outputType":"blue","quantity":"10"},{"outputType":"dust","quantity":"5000"}]}]},"bronte":{"name":"Bronte","type":"Worker","baseTime":"10","outputs":["green","dust"],"upgrades":[{"level":"1","prereq":"trinity","costs":[{"egg":"blue","quantity":"250"}],"results":[{"outputType":"green","quantity":"1"},{"outputType":"dust","quantity":"25"}]},{"level":"2","costs":[{"egg":"green","quantity":"50"},{"egg":"blue","quantity":"250"}],"results":[{"outputType":"green","quantity":"2"},{"outputType":"dust","quantity":"50"}]},{"level":"3","costs":[{"egg":"green","quantity":"300"}],"results":[{"outputType":"green","quantity":"3"},{"outputType":"dust","quantity":"125"}]},{"level":"4","costs":[{"egg":"green","quantity":"1300"}],"results":[{"outputType":"green","quantity":"4"},{"outputType":"dust","quantity":"250"}]},{"level":"5","costs":[{"egg":"green","quantity":"2500"},{"egg":"blue","quantity":"5000"}],"results":[{"outputType":"green","quantity":"5"},{"outputType":"dust","quantity":"500"}]},{"level":"6","costs":[{"egg":"green","quantity":"5000"}],"results":[{"outputType":"green","quantity":"6"},{"outputType":"dust","quantity":"1000"}]},{"level":"7","costs":[{"egg":"red","quantity":"750"}],"results":[{"outputType":"green","quantity":"7"},{"outputType":"dust","quantity":"2500"}]},{"level":"8","costs":[{"egg":"red","quantity":"1000"},{"egg":"green","quantity":"5000"}],"results":[{"outputType":"green","quantity":"8"},{"outputType":"dust","quantity":"5000"}]},{"level":"9","costs":[{"egg":"red","quantity":"2500"}],"results":[{"outputType":"green","quantity":"9"},{"outputType":"dust","quantity":"10000"}]},{"level":"10","costs":[{"egg":"yellow","quantity":"1000"}],"results":[{"outputType":"green","quantity":"10"},{"outputType":"dust","quantity":"15000"}]}]},"anne":{"name":"Anne","type":"Worker","baseTime":"15","outputs":["blue","green"],"upgrades":[{"level":"1","prereq":"bronte","costs":[{"egg":"green","quantity":"750"}],"results":[{"outputType":"green","quantity":"2"},{"outputType":"blue","quantity":"3"}]},{"level":"2","costs":[{"egg":"blue","quantity":"2000"}],"results":[{"outputType":"green","quantity":"4"},{"outputType":"blue","quantity":"6"}]},{"level":"3","costs":[{"egg":"green","quantity":"2500"}],"results":[{"outputType":"green","quantity":"6"},{"outputType":"blue","quantity":"9"}]},{"level":"4","costs":[{"egg":"red","quantity":"500"}],"results":[{"outputType":"green","quantity":"8"},{"outputType":"blue","quantity":"12"}]},{"level":"5","costs":[{"egg":"green","quantity":"5000"}],"results":[{"outputType":"green","quantity":"10"},{"outputType":"blue","quantity":"15"}]},{"level":"6","costs":[{"egg":"yellow","quantity":"500"}],"results":[{"outputType":"green","quantity":"12"},{"outputType":"blue","quantity":"18"}]},{"level":"7","costs":[{"egg":"red","quantity":"3000"}],"results":[{"outputType":"green","quantity":"14"},{"outputType":"blue","quantity":"21"}]},{"level":"8","costs":[{"egg":"yellow","quantity":"2500"}],"results":[{"outputType":"green","quantity":"16"},{"outputType":"blue","quantity":"24"}]}]},"petra":{"name":"Petra","type":"Worker","baseTime":"20","outputs":["red","dust"],"upgrades":[{"level":"1","prereq":"anne","costs":[{"egg":"green","quantity":"5000"}],"results":[{"outputType":"red","quantity":"1"},{"outputType":"dust","quantity":"250"}]},{"level":"2","costs":[{"egg":"red","quantity":"100"}],"results":[{"outputType":"red","quantity":"2"},{"outputType":"dust","quantity":"500"}]},{"level":"3","costs":[{"egg":"red","quantity":"1000"}],"results":[{"outputType":"red","quantity":"3"},{"outputType":"dust","quantity":"1000"}]},{"level":"4","costs":[{"egg":"green","quantity":"5000"},{"egg":"blue","quantity":"10000"}],"results":[{"outputType":"red","quantity":"4"},{"outputType":"dust","quantity":"2000"}]},{"level":"5","costs":[{"egg":"red","quantity":"3000"},{"egg":"green","quantity":"10000"}],"results":[{"outputType":"red","quantity":"5"},{"outputType":"dust","quantity":"5000"}]},{"level":"6","costs":[{"egg":"yellow","quantity":"3000"}],"results":[{"outputType":"red","quantity":"6"},{"outputType":"dust","quantity":"10000"}]},{"level":"7","costs":[{"egg":"green","quantity":"20000"}],"results":[{"outputType":"red","quantity":"7"},{"outputType":"dust","quantity":"20000"}]},{"level":"8","costs":[{"egg":"red","quantity":"10000"}],"results":[{"outputType":"red","quantity":"8"},{"outputType":"dust","quantity":"30000"}]},{"level":"9","costs":[{"egg":"yellow","quantity":"5000"}],"results":[{"outputType":"red","quantity":"9"},{"outputType":"dust","quantity":"40000"}]},{"level":"10","costs":[{"egg":"blue","quantity":"50000"}],"results":[{"outputType":"red","quantity":"10"},{"outputType":"dust","quantity":"50000"}]}]},"manny":{"name":"Manny","type":"Worker","baseTime":"25","outputs":["dust"],"upgrades":[{"level":"1","prereq":"petra","costs":[{"egg":"red","quantity":"2500"}],"results":[{"outputType":"dust","quantity":"1000"}]},{"level":"2","costs":[{"egg":"green","quantity":"5000"},{"egg":"blue","quantity":"5000"}],"results":[{"outputType":"dust","quantity":"2000"}]},{"level":"3","costs":[{"egg":"red","quantity":"5000"}],"results":[{"outputType":"dust","quantity":"5000"}]},{"level":"4","costs":[{"egg":"green","quantity":"15000"},{"egg":"blue","quantity":"30000"}],"results":[{"outputType":"dust","quantity":"10000"}]},{"level":"5","costs":[{"egg":"yellow","quantity":"3000"}],"results":[{"outputType":"dust","quantity":"15000"}]},{"level":"6","costs":[{"egg":"red","quantity":"20000"}],"results":[{"outputType":"dust","quantity":"20000"}]},{"level":"7","costs":[{"egg":"yellow","quantity":"10000"}],"results":[{"outputType":"dust","quantity":"30000"}]},{"level":"8","costs":[{"egg":"green","quantity":"40000"},{"egg":"blue","quantity":"40000"}],"results":[{"outputType":"dust","quantity":"50000"}]},{"level":"9","costs":[{"egg":"red","quantity":"30000"}],"results":[{"outputType":"dust","quantity":"75000"}]},{"level":"10","costs":[{"egg":"blue","quantity":"100000"}],"results":[{"outputType":"dust","quantity":"100000"}]}]},"tony":{"name":"Tony","type":"Worker","baseTime":"30","outputs":["yellow","dust"],"upgrades":[{"level":"1","prereq":"manny","costs":[{"egg":"red","quantity":"5000"},{"egg":"green","quantity":"15000"}],"results":[{"outputType":"yellow","quantity":"1"},{"outputType":"dust","quantity":"2500"}]},{"level":"2","costs":[{"egg":"green","quantity":"15000"},{"egg":"blue","quantity":"25000"}],"results":[{"outputType":"yellow","quantity":"2"},{"outputType":"dust","quantity":"5000"}]},{"level":"3","costs":[{"egg":"blue","quantity":"100000"}],"results":[{"outputType":"yellow","quantity":"3"},{"outputType":"dust","quantity":"10000"}]},{"level":"4","costs":[{"egg":"red","quantity":"5000"},{"egg":"green","quantity":"20000"}],"results":[{"outputType":"yellow","quantity":"4"},{"outputType":"dust","quantity":"20000"}]},{"level":"5","costs":[{"egg":"yellow","quantity":"5000"}],"results":[{"outputType":"yellow","quantity":"5"},{"outputType":"dust","quantity":"30000"}]},{"level":"6","costs":[{"egg":"red","quantity":"10000"}],"results":[{"outputType":"yellow","quantity":"6"},{"outputType":"dust","quantity":"50000"}]},{"level":"7","costs":[{"egg":"yellow","quantity":"10000"}],"results":[{"outputType":"yellow","quantity":"7"},{"outputType":"dust","quantity":"75000"}]},{"level":"8","costs":[{"egg":"blue","quantity":"125000"}],"results":[{"outputType":"yellow","quantity":"8"},{"outputType":"dust","quantity":"100000"}]},{"level":"9","costs":[{"egg":"green","quantity":"50000"},{"egg":"blue","quantity":"50000"}],"results":[{"outputType":"yellow","quantity":"9"},{"outputType":"dust","quantity":"150000"}]},{"level":"10","costs":[{"egg":"red","quantity":"30000"}],"results":[{"outputType":"yellow","quantity":"10"},{"outputType":"dust","quantity":"200000"}]}]},"ruth":{"name":"Ruth","type":"Worker","baseTime":"35","outputs":["red","yellow"],"upgrades":[{"level":"1","prereq":"tony","costs":[{"egg":"yellow","quantity":"5000"}],"results":[{"outputType":"yellow","quantity":"2"},{"outputType":"red","quantity":"3"}]},{"level":"2","costs":[{"egg":"red","quantity":"2500"}],"results":[{"outputType":"yellow","quantity":"4"},{"outputType":"red","quantity":"6"}]},{"level":"3","costs":[{"egg":"green","quantity":"15000"},{"egg":"blue","quantity":"15000"}],"results":[{"outputType":"yellow","quantity":"6"},{"outputType":"red","quantity":"9"}]},{"level":"4","costs":[{"egg":"yellow","quantity":"2500"}],"results":[{"outputType":"yellow","quantity":"8"},{"outputType":"red","quantity":"12"}]},{"level":"5","costs":[{"egg":"green","quantity":"25000"}],"results":[{"outputType":"yellow","quantity":"10"},{"outputType":"red","quantity":"15"}]},{"level":"6","costs":[{"egg":"red","quantity":"5000"}],"results":[{"outputType":"yellow","quantity":"12"},{"outputType":"red","quantity":"18"}]},{"level":"7","costs":[{"egg":"blue","quantity":"75000"}],"results":[{"outputType":"yellow","quantity":"14"},{"outputType":"red","quantity":"21"}]},{"level":"8","costs":[{"egg":"green","quantity":"50000"}],"results":[{"outputType":"yellow","quantity":"16"},{"outputType":"red","quantity":"24"}]}]},"rex":{"name":"Rex","type":"Worker","baseTime":"40","outputs":["dust"],"upgrades":[{"level":"1","prereq":"ruth","costs":[{"egg":"yellow","quantity":"10000"},{"egg":"red","quantity":"20000"}],"results":[{"outputType":"dust","quantity":"5000"}]},{"level":"2","costs":[{"egg":"blue","quantity":"75000"}],"results":[{"outputType":"dust","quantity":"10000"}]},{"level":"3","costs":[{"egg":"yellow","quantity":"15000"}],"results":[{"outputType":"dust","quantity":"20000"}]},{"level":"4","costs":[{"egg":"green","quantity":"75000"}],"results":[{"outputType":"dust","quantity":"35000"}]},{"level":"5","costs":[{"egg":"red","quantity":"20000"}],"results":[{"outputType":"dust","quantity":"50000"}]},{"level":"6","costs":[{"egg":"blue","quantity":"100000"}],"results":[{"outputType":"dust","quantity":"75000"}]},{"level":"7","costs":[{"egg":"yellow","quantity":"25000"}],"results":[{"outputType":"dust","quantity":"100000"}]},{"level":"8","costs":[{"egg":"green","quantity":"75000"},{"egg":"blue","quantity":"75000"}],"results":[{"outputType":"dust","quantity":"200000"}]},{"level":"9","costs":[{"egg":"blue","quantity":"100000"}],"results":[{"outputType":"dust","quantity":"300000"}]},{"level":"10","costs":[{"egg":"red","quantity":"50000"}],"results":[{"outputType":"dust","quantity":"400000"}]}]},"blue":{"name":"Blue","firstCreatedBy":"trinity","type":"Egg","upgrades":[{"level":"1","costs":[{"egg":"green","quantity":"200"}]},{"level":"2","costs":[{"egg":"blue","quantity":"1000"}]},{"level":"3","costs":[{"egg":"green","quantity":"2000"}]},{"level":"4","costs":[{"egg":"red","quantity":"1000"}]}]},"green":{"name":"Green","firstCreatedBy":"bronte","type":"Egg","upgrades":[{"level":"1","costs":[{"egg":"blue","quantity":"500"}]},{"level":"2","costs":[{"egg":"green","quantity":"1000"}]},{"level":"3","costs":[{"egg":"red","quantity":"1500"}]}]},"red":{"name":"Red","firstCreatedBy":"petra","type":"Egg","upgrades":[{"level":"1","costs":[{"egg":"red","quantity":"500"}]},{"level":"2","costs":[{"egg":"yellow","quantity":"2000"}]}]},"yellow":{"name":"Yellow","firstCreatedBy":"tony","type":"Egg","upgrades":[{"level":"1","costs":[{"egg":"red","quantity":"5000"}]}]},"speed":{"name":"Speed","type":"Buff","upgrades":[{"level":"1","costs":[{"egg":"blue","quantity":"10000"}],"result":"0.05"},{"level":"2","costs":[{"egg":"green","quantity":"25000"}],"result":"0.10"},{"level":"3","costs":[{"egg":"red","quantity":"10000"}],"result":"0.15"},{"level":"4","costs":[{"egg":"yellow","quantity":"15000"}],"result":"0.2"},{"level":"5","costs":[{"egg":"blue","quantity":"125000"}],"result":"0.25"}]},"dust":{"name":"Dust","type":"Buff","upgrades":[{"level":"1","costs":[{"egg":"blue","quantity":"25000"}],"result":"0.25"},{"level":"2","costs":[{"egg":"green","quantity":"30000"}],"result":"0.5"},{"level":"3","costs":[{"egg":"red","quantity":"15000"}],"result":"0.75"},{"level":"4","costs":[{"egg":"blue","quantity":"100000"}],"result":"1"},{"level":"5","costs":[{"egg":"green","quantity":"50000"}],"result":"1.25"},{"level":"6","costs":[{"egg":"yellow","quantity":"25000"}],"result":"1.5"}]}}');let x=["blue","green","red","yellow"];function getProductionCostsFromJSON(e,t){let n=f[e].upgrades[t-1];for(let e=0;e<n.costs.length;e++)if(!x.includes(n.costs[e].egg))throw Error("JSON error: costs");return n.costs}function getWorkerOutputsFromJSON(e){let t=f[e];if("outputs"in t)return t.outputs;if("Worker"===t.type)throw Error("JSON error: Worker has no outputs");return null}function getUpgradeDataFromJSON(e,t){let n=f[e];if(t<=n.upgrades.length)return n.upgrades[t-1];throw Error("JSON error: nonexistent upgrade level")}function getBuffResultFromJSON(e,t){let n=getUpgradeDataFromJSON(e,t);if("result"in n)return n.result;if("Buff"===f[e].type)throw Error("JSON error: Buff has no result");return null}function getUpgradesDataFromJSON(e){return f[e].upgrades}function getMainKeysFromJSON(){return Object.keys(f)}function utils_deepCopy(e){return structuredClone(e)}let h={days:3,hours:0,minutes:0},y={dust:0,blue:0,green:0,red:0,yellow:0},b={trinity:"blue",bronte:"green",anne:"blue",petra:"red",manny:"dust",tony:"yellow",ruth:"red",rex:"dust"},v={trinity:0,bronte:0,anne:0,petra:0,manny:0,tony:0,ruth:0,rex:0,blue:0,green:0,red:0,yellow:0,speed:0,dust:0},S={timeEntered:new Date,startTime:new Date,timeRemaining:4320,premiumInfo:{adBoost:!1,allEggs:0},stockpiles:utils_deepCopy(y),levels:utils_deepCopy(v)},j={dateOffset:0,hours:0,minutes:0},T={dateOffset:0,hours:0,minutes:1};function calcProductionRates(e,t,n){return{blue:calcProductionRate("blue",e,t,n),green:calcProductionRate("green",e,t,n),red:calcProductionRate("red",e,t,n),yellow:calcProductionRate("yellow",e,t,n),dust:calcProductionRate("dust",e,t,n)}}function calcProductionRate(e,t,n,l){let i=function(e,t,n){let l=[];for(let i in n){if(!(i in t))return null;n[i]==e&&t[i]>0&&l.push(i)}return l}(e,t,l);if(null===i||0===i.length)return 0;let r=function(e,t,n){let l=[];for(let i=0;i<e.length;i++){let r=e[i],s=f[r];if(!("baseTime"in s))return null;{let e=n[r]-1,i=s.upgrades[e].results,a=null;if(i[0].outputType===t?a=0:i[1].outputType===t&&(a=1),null===a)return null;let o={baseTime:s.baseTime,quantity:i[a].quantity};l.push(o)}}return l}(i,e,t);if(null===r||0===r.length)return 0;let s=function(e,t,n){let l=0,i=0,r=function(e,t){let n=t.adBoost?.25:0,l="speed",i=0;if(e[l]>0){let t=getBuffResultFromJSON(l,e[l]);if(null==t)throw Error("Speed upgrade buff not applied");i=parseFloat(t)}return 1-n-i}(e,t);for(let e=0;e<n.length;e++){let t=parseFloat(n[e].baseTime)*r,s=60/t,a=s*parseInt(n[e].quantity);i+=s,l+=a}return{productionPerMin:l,actionsPerMin:i}}(t,n,r);return function(e,t,n,l,i){let r="dust";if(r===n){if(l[r]>0){let t=getBuffResultFromJSON(r,l[r]);if(null==t)throw Error("Dust upgrade buff not applied");let n=parseFloat(t);e*=1+n}}else e+=l[n]*t+i.allEggs*t;return e}(s.productionPerMin,s.actionsPerMin,e,t,n)}function calcStockpilesAdvancedByTime(e,t,n){let l=utils_deepCopy(e);for(let i in e){let e=Math.round(t*n[i]);l[i]+=e}return l}function calcProductionSettingsBeforeIndex(e){let{actions:t,index:n}=e,l=utils_deepCopy(b);t=utils_deepCopy(t);let i=null===n?t.filter(e=>"switch"===e.type):t.slice(0,n).filter(e=>"switch"===e.type);for(let e=0;e<i.length;e++){let t=i[e];"to"in t&&(l[t.key]=t.to)}return l}function convertDateToTimeID(e,t){return Math.round(Math.abs(e.getTime()-t.startTime.getTime())/6e4)}function convertTimeIDToDate(e,t){return new Date(t.startTime.getTime()+6e4*e)}function convertTimeIDToTimeRemaining(e){let t=Math.max(Math.floor(e/24/60),0);return{days:t,hours:Math.floor((e-1440*t)/60),minutes:e%60}}function convertTimeRemainingToMinutes(e){let t=isNaN(e.days)?0:e.days,n=isNaN(e.hours)?0:e.hours,l=isNaN(e.minutes)?0:e.minutes;return 1440*t+60*n+l}function calcDHMString(e){return"".concat(e.days,"d").concat(nbsp()).concat(e.hours,"h").concat(nbsp()).concat(e.minutes,"m")}function calcMonthName(e){let t=new Date;return t.setMonth(e),t.toLocaleString([],{month:"short"})}function calcDateWithTimeDisplayStr(e){return calcDateDisplayStr(e)+nbsp()+calcTimeDisplayStr(e)}function calcDateDisplayStr(e){return e.getDate().toString().padStart(2,"0")+nbsp()+calcMonthName(e.getMonth())}function calcTimeDisplayStr(e){return e.toLocaleTimeString([],{timeStyle:"short",hourCycle:"h23"})}function calcDustAtEndWithMaxDustProduction(e){let{timeID:t,stockpiles:n,levels:l,premiumInfo:i,productionSettings:r}=e,s=4320-t;if(s<0)return{value:0,rate:0};let a=calcMaxDustRate(l,i,r);return{value:Math.round(s*a+n.dust),rate:a}}function calcMaxDustRate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b,l=function(e){let t=utils_deepCopy(e);for(let[e,n]of Object.entries(t)){let n=getWorkerOutputsFromJSON(e);null!==n&&n.includes("dust")&&(t[e]="dust")}return t}(n);return calcProductionRate("dust",e,t,l)}function findIndexLastTimeGroupInTime(e){let t=Math.max.apply(Math,e.filter(e=>e.timeID<=4320).map(e=>e.timeID)),n=e.findIndex(e=>e.timeID===t);return n}function isDuringOfflinePeriod(e){let{timeID:t,offlinePeriods:n,startedAt:l}=e;return -1!==findIndexOfOfflinePeriod({timeID:t,offlinePeriods:n,startedAt:l})}function findIndexOfOfflinePeriod(e){let{timeID:t,offlinePeriods:n,startedAt:l}=e;return n.findIndex(e=>{let n=convertOfflineTimeToTimeID(e.start,l),i=convertOfflineTimeToTimeID(e.end,l);return t>=n&&t<i})}function convertOfflineTimeToDate(e,t){let n=new Date(t.getTime()),l=t.getDate()+e.dateOffset;return n.setDate(l),n.setHours(e.hours,e.minutes),n}function convertOfflineTimeToTimeID(e,t){let n=convertOfflineTimeToDate(e,t),l=n.getTime()-t.getTime(),i=Math.round(l/6e4);return 0>i?0:4320<i?4321:i}function printOfflineTime(e){return"".concat(e.dateOffset,"d").concat(e.hours,"h").concat(e.minutes,"m")}function convertOfflineTimeToNumber(e){let t=fixOfflineTimeStrings(e);return 1440*t.dateOffset+60*t.hours+t.minutes}function fixOfflineTimeStrings(e){let t="string"==typeof e.dateOffset?parseInt(e.dateOffset):e.dateOffset,n="string"==typeof e.hours?parseInt(e.hours):e.hours,l="string"==typeof e.minutes?parseInt(e.minutes):e.minutes;return{dateOffset:t,hours:n,minutes:l}}function calcPlanData(e){let{gameState:t,actions:n,offlinePeriods:l,prodSettingsNow:i}=e;if(null===t)return null;let r=[],s={},a={},o=calcProductionSettingsBeforeIndex({actions:n,index:0}),u=utils_deepCopy(o),d=!1,c=t.startTime,p=utils_deepCopy(t.stockpiles),g=utils_deepCopy(t.levels),m=utils_deepCopy(o),f=calcProductionRates(g,t.premiumInfo,m),x=4320>t.timeRemaining?4320-t.timeRemaining:0,h=null;try{for(let e=0;e<n.length;e++){let{type:t,...a}=n[e];"switch"===t?function(e){let{switchAction:t,idx:n}=e;!(x>=4321)&&((null===h?m:h.productionSettings)[t.key]=t.to,d&&function(e){let{switchAction:t,idx:n}=e,l={key:t.key,to:t.to,actionsIdx:n},i=null===h?x.toString():h.endTimeID.toString();i in s||(s[i]=[]);let r=s[i].findIndex(e=>e.key===l.key);-1===r?s[i].push(l):s[i][r]=l}({switchAction:t,idx:n}))}({idx:e,switchAction:a}):function(e){let{upgradeAction:t,idx:n}=e;if(t.level<=g[t.key])return;if(d||Object.assign(u,utils_deepCopy(m)),x>=4321){handleOutOfTimeUpgradeAction({upgradeAction:t,idx:n});return}let s=getProductionCostsFromJSON(t.key,t.level);isDuringOfflinePeriod({timeID:x,offlinePeriods:l,startedAt:c})||updateProductionRates(),(x=function advanceStockpilesToReadyToPurchaseTimeID(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timeID:x,prodSettingsNow:!1,offlinePeriodEnd:!1},r=function(e,t,n){let l=0;for(let i=0;i<e.length;i++){let r=e[i].egg,s=parseInt(e[i].quantity),a=t[r];if(s>a){if(0===n[r])return 4321;let e=s-a,t=Math.ceil(e/n[r]);l=l>t?l:t}}return l}(e,p,f),s=n.timeID+r,a=function(e,t){let n=!t.prodSettingsNow&&function(e){let{prevTimeID:t,thisTimeID:n}=e;return null!==i&&!d&&i.timeID>=t&&i.timeID<n}({prevTimeID:x,thisTimeID:e}),l=!t.offlinePeriodEnd&&null!==h&&e>h.endTimeID;if(n&&l&&null!==i&&null!==h){let e=Math.min(h.endTimeID,i.timeID);return e===i.timeID?"prodSettingsNow":"offlinePeriodEnd"}return n?"prodSettingsNow":l?"offlinePeriodEnd":"noChange"}(s,n);return"prodSettingsNow"!==a||n.prodSettingsNow?"offlinePeriodEnd"!==a||n.prodSettingsNow?s>4320?(advanceStockpilesToValidTimeID({startTimeID:n.timeID,endTimeID:4321}),4321):(null===h&&isDuringOfflinePeriod({timeID:s,offlinePeriods:l,startedAt:c})&&function(e){let t=function(e){let{timeID:t,offlinePeriods:n,startedAt:l}=e,i=findIndexOfOfflinePeriod({timeID:t,offlinePeriods:n,startedAt:l});return -1===i?null:{start:convertOfflineTimeToTimeID(n[i].start,l),end:convertOfflineTimeToTimeID(n[i].end,l)}}({timeID:e,offlinePeriods:l,startedAt:c});null!==t&&(h={startTimeID:t.start,endTimeID:t.end,productionSettings:utils_deepCopy(m),levels:utils_deepCopy(g)})}(s),advanceStockpilesToValidTimeID({startTimeID:n.timeID,endTimeID:s}),s):(n.timeID=updateForEndOfActiveOfflinePeriod(n.timeID),n.offlinePeriodEnd=!0,advanceStockpilesToReadyToPurchaseTimeID(e,n)):(n.timeID=(t=n.timeID,null===i?x:(advanceStockpilesToValidTimeID({startTimeID:t,endTimeID:i.timeID}),Object.assign(m,i.productionSettings),updateProductionRates(),i.timeID)),n.prodSettingsNow=!0,advanceStockpilesToReadyToPurchaseTimeID(e,n))}(s))>=4321?handleOutOfTimeUpgradeAction({upgradeAction:t,idx:n}):function(e){let{upgradeAction:t,idx:n,costs:l}=e;(function(e){for(let t=0;t<e.length;t++){let n=e[t].egg,l=parseInt(e[t].quantity);if(l>p[n])throw Error("Purchase failed, not enough eggs");p[n]-=l}})(l),function(e){let t=null===h?g:h.levels;t[e.key]=e.level}(t);let i=null===h?x:h.endTimeID,s=createPurchaseData({upgradeAction:t,idx:n,readyTimeID:x,purchaseTimeID:i});r.push(s),null===h&&addToTimeData(i)}({upgradeAction:t,idx:n,costs:s}),d||(d=!0)}({idx:e,upgradeAction:a})}return null!==h&&(x=updateForEndOfActiveOfflinePeriod(x)),{purchaseData:r,switchData:s,productionSettingsBeforeNow:u,timeData:a}}catch(e){return null}function addToTimeData(e){e.toString() in a?function(e){let t=createTimeData(e),n=a[e.toString()],l=utils_deepCopy(n.productionSettingsDuring),i=utils_deepCopy(n.ratesDuring);Object.assign(n,t),n.productionSettingsDuring=l,n.ratesDuring=i}(e):a[e.toString()]=createTimeData(e)}function advanceStockpilesToValidTimeID(e){let{startTimeID:t,endTimeID:n}=e;n=n>4321?4321:n;let l=n-t,i=calcStockpilesAdvancedByTime(p,l,f);Object.assign(p,i)}function createPurchaseData(e){let{upgradeAction:t,idx:n,readyTimeID:l,purchaseTimeID:i}=e,r=null===h?utils_deepCopy(g):utils_deepCopy(h.levels);return r[t.key]=t.level-1,{...t,readyTimeID:l,purchaseTimeID:i,actionsIdx:n,stockpiles:utils_deepCopy(p),levelsAbove:r}}function createTimeData(e){let n=calcDustAtEndWithMaxDustProduction({timeID:e,stockpiles:p,levels:g,premiumInfo:t.premiumInfo,productionSettings:m});return{productionSettingsDuring:utils_deepCopy(m),ratesDuring:utils_deepCopy(f),levelsAtEnd:utils_deepCopy(g),stockpilesAtEnd:utils_deepCopy(p),allToDustAfter:n,startOfflinePeriodTimeID:h?h.startTimeID:null}}function handleOutOfTimeUpgradeAction(e){let{upgradeAction:t,idx:n}=e,l=createPurchaseData({upgradeAction:t,idx:n,readyTimeID:4321,purchaseTimeID:4321});r.push(l),"4321"in a||addToTimeData(4321)}function updateForEndOfActiveOfflinePeriod(e){if(null===h)return x;let t=h.endTimeID,n=t<4321?t:4321;return advanceStockpilesToValidTimeID({startTimeID:e,endTimeID:n}),t<4321&&Object.assign(g,h.levels),addToTimeData(n),Object.assign(m,h.productionSettings),updateProductionRates(),h=null,n}function updateProductionRates(){Object.assign(f,calcProductionRates(g,t.premiumInfo,m))}}function IconClose(e){let{size:t}=e;return(0,a.jsx)("svg",{width:t,height:t,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.27933 11.3718C2.90689 11.7442 2.90689 12.3481 3.27933 12.7205C3.65177 13.093 4.25561 13.093 4.62805 12.7205L7.99994 9.34861L11.3719 12.7207C11.7444 13.0931 12.3482 13.0931 12.7207 12.7207C13.0931 12.3482 13.0931 11.7444 12.7207 11.3719L9.34866 7.99986L12.7204 4.62808C13.0928 4.25563 13.0928 3.65178 12.7204 3.27933C12.348 2.90689 11.7441 2.90689 11.3717 3.27933L7.99994 6.65112L4.62833 3.27946C4.25589 2.90702 3.65205 2.90702 3.27961 3.27946C2.90717 3.65191 2.90717 4.25576 3.27961 4.62821L6.65121 7.99986L3.27933 11.3718Z"})})}function IconCheck(e){let{size:t,colour:n}=e;return(0,a.jsx)("svg",{width:t,height:t,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,a.jsx)("path",{d:"M4.71996 8.00006C4.5323 7.8313 4.28778 7.73973 4.03543 7.74373C3.78308 7.74773 3.54158 7.84699 3.35936 8.02162C3.17715 8.19624 3.0677 8.4333 3.05297 8.68525C3.03825 8.9372 3.11933 9.1854 3.27996 9.38006L5.49996 11.7101C5.5929 11.8076 5.70459 11.8853 5.82832 11.9386C5.95204 11.9918 6.08525 12.0195 6.21996 12.0201C6.35395 12.0208 6.48673 11.9947 6.61041 11.9432C6.7341 11.8916 6.84616 11.8158 6.93996 11.7201L13.72 4.72006C13.8119 4.62551 13.8843 4.51378 13.933 4.39124C13.9818 4.26871 14.0059 4.13778 14.004 4.00592C14.0022 3.87406 13.9744 3.74386 13.9222 3.62275C13.87 3.50163 13.7945 3.39199 13.7 3.30006C13.6054 3.20814 13.4937 3.13573 13.3711 3.08699C13.2486 3.03824 13.1177 3.01411 12.9858 3.01597C12.854 3.01783 12.7238 3.04564 12.6026 3.09781C12.4815 3.14999 12.3719 3.22551 12.28 3.32006L6.22996 9.58006L4.71996 8.00006Z",fill:null!=n?n:"white"})})}function IconEyeClosed(e){let{size:t,colour:n}=e;return(0,a.jsx)("svg",{width:t,height:t,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,a.jsx)("path",{d:"M1.33341 2.84667L2.18675 2L13.3334 13.1467L12.4867 14L10.4334 11.9467C9.66675 12.2 8.85341 12.3333 8.00008 12.3333C4.66675 12.3333 1.82008 10.26 0.666748 7.33333C1.12675 6.16 1.86008 5.12667 2.79341 4.30667L1.33341 2.84667ZM8.00008 5.33333C8.53051 5.33333 9.03922 5.54405 9.4143 5.91912C9.78937 6.29419 10.0001 6.8029 10.0001 7.33333C10.0001 7.56667 9.96008 7.79333 9.88675 8L7.33342 5.44667C7.54008 5.37333 7.76675 5.33333 8.00008 5.33333ZM8.00008 2.33333C11.3334 2.33333 14.1801 4.40667 15.3334 7.33333C14.7867 8.72 13.8601 9.92 12.6667 10.7933L11.7201 9.84C12.6267 9.21333 13.3734 8.36 13.8801 7.33333C12.7801 5.09333 10.5067 3.66667 8.00008 3.66667C7.27342 3.66667 6.56008 3.78667 5.89341 4L4.86675 2.98C5.82675 2.56667 6.88675 2.33333 8.00008 2.33333ZM2.12008 7.33333C3.22008 9.57333 5.49341 11 8.00008 11C8.46008 11 8.91341 10.9533 9.33342 10.86L7.81342 9.33333C6.86008 9.23333 6.10008 8.47333 6.00008 7.52L3.73341 5.24667C3.07341 5.81333 2.52008 6.52 2.12008 7.33333Z",fill:null!=n?n:"white"})})}function IconEyeOpen(e){let{size:t,colour:n}=e;return(0,a.jsx)("svg",{width:t,height:t,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,a.jsx)("path",{d:"M8.00008 6C8.53051 6 9.03922 6.21071 9.4143 6.58579C9.78937 6.96086 10.0001 7.46957 10.0001 8C10.0001 8.53043 9.78937 9.03914 9.4143 9.41421C9.03922 9.78929 8.53051 10 8.00008 10C7.46965 10 6.96094 9.78929 6.58587 9.41421C6.21079 9.03914 6.00008 8.53043 6.00008 8C6.00008 7.46957 6.21079 6.96086 6.58587 6.58579C6.96094 6.21071 7.46965 6 8.00008 6ZM8.00008 3C11.3334 3 14.1801 5.07333 15.3334 8C14.1801 10.9267 11.3334 13 8.00008 13C4.66675 13 1.82008 10.9267 0.666748 8C1.82008 5.07333 4.66675 3 8.00008 3ZM2.12008 8C3.22008 10.24 5.49341 11.6667 8.00008 11.6667C10.5067 11.6667 12.7801 10.24 13.8801 8C12.7801 5.76 10.5067 4.33333 8.00008 4.33333C5.49341 4.33333 3.22008 5.76 2.12008 8Z",fill:null!=n?n:"white"})})}function ReactifyInkscapeStyle(e){let t={},n=e.split(";");for(let e=0;e<n.length;e++){let l=n[e].split(":"),i=l[0];if("-inkscape-font-specification"===i)break;let r=l[1],s=i.indexOf("-");-1===s?t[i]=r:t[i.slice(0,s)+i.slice(s+1,s+2).charAt(0).toUpperCase()+i.slice(s+2).slice(0)]=r}return t}(i=s||(s={})).prodSettingsNow="prodSettingsNow",i.offlinePeriodEnd="offlinePeriodEnd",i.noChange="noChange";let w={primary:{main:"text-white bg-violet-700 hover:bg-violet-600 border-violet-700",disabled:"text-gray-500 bg-gray-300",toggledOn:"text-white bg-violet-950 hover:bg-violet-800 border-violet-950"},primaryOnDark:{main:"text-violet-950 bg-violet-200 hover:bg-violet-300 border-violet-200",disabled:"text-gray-500 bg-gray-300",toggledOn:"text-violet-950 bg-violet-400 hover:bg-violet-300 hover:text-violet-950 border-violet-50"},secondary:{main:"border-2 text-violet-600 bg-transparent border-violet-600 hover:bg-violet-50",disabled:"border-2 text-gray-500 border-gray-300"},secondaryOnDark:{main:"border-2 text-violet-100 bg-transparent border-violet-100 hover:bg-violet-50 hover:bg-opacity-10",disabled:"border-2 text-gray-500 border-gray-300 md:opacity-70"},warning:{main:"border-2 text-violet-600 bg-white bg-opacity-50 border-violet-600 hover:bg-red-700 hover:border-red-700 hover:text-white",disabled:"border-2 text-gray-500 border-gray-300"},more:{main:"bg-violet-200      border-violet-200   text-white          hover:bg-violet-100     hover:text-violet-400",toggledOn:"bg-violet-300      border-violet-400   text-violet-600     hover:bg-violet-200     hover:text-violet-400"},moreOffline:{main:"bg-greyBlue-400    border-greyBlue-400 text-white          hover:bg-greyBlue-300   hover:text-greyBlue-100",toggledOn:"bg-greyBlue-600    border-greyBlue-800 text-white          hover:bg-greyBlue-300   hover:text-greyBlue-100"}},N={default:"w-24 h-8",inline:"text-xs px-2 py-0.5",stickyBar:"text-sm px-3 py-1",twin:"text-sm w-2/5 py-1",planner:"text-sm w-20 h-7",full:"text-base w-full py-2",pos:"px-0.25 py-0.75"};function Button(e){let{size:t,colours:n,htmlType:l,extraCSS:i,onClick:r,disabled:s,toggledOn:o,children:u}=e;return(0,a.jsx)("button",{className:"rounded "+function(e){let{size:t,colours:n,disabled:l,toggledOn:i,extraCSS:r}=e,s=t in N?N[t]:N.default,a=n in w?w[n]:w.primary;return null!==a&&(l&&"disabled"in a?s+=" "+a.disabled:i&&"toggledOn"in a?s+=" "+a.toggledOn:s+=" "+a.main),void 0!==r&&(s+=" "+r),s}({size:t,colours:n,disabled:s,toggledOn:o,extraCSS:i}),type:"submit"===l||"reset"===l||"button"===l||void 0===l?l:"submit",onClick:r,disabled:s,children:u})}function MoreButton(e){let{showMore:t,setShowMore:n,modeKey:l}=e;return(0,a.jsxs)(RoundToggleButtonWrapper,{showMore:t,setShowMore:n,modeKey:l,extraCSS:"",children:[(0,a.jsx)("span",{"aria-hidden":!0,children:"..."}),(0,a.jsx)("span",{className:"sr-only",children:"more info"})]})}function InfoButton(e){let{showMore:t,setShowMore:n,modeKey:l}=e;return(0,a.jsxs)(RoundToggleButtonWrapper,{showMore:t,setShowMore:n,modeKey:l,extraCSS:"font-serif text-xl leading-none items-center",children:[(0,a.jsx)("span",{"aria-hidden":!0,children:"i"}),(0,a.jsx)("span",{className:"sr-only",children:"see stockpiles"})]})}function RoundToggleButtonWrapper(e){let{showMore:t,setShowMore:n,modeKey:l,extraCSS:i,children:r}=e,s=w[l="moreOffline"!==l&&"primary"!==l?"more":l];"main"in s&&"toggledOn"in s||(s=w.more);let o=s[t?"toggledOn":"main"];return(0,a.jsx)("button",{className:"rounded-full border-2 flex justify-center w-7 h-7 "+o+" "+i,onClick:()=>n(e=>!e),type:"button",children:r})}function HeaderFooterContentWrapper(e){let{borderColour:t,padding:n,margins:l,children:i}=e;return t=null!=t?t:"border-violet-500",(0,a.jsx)("div",{className:"border-l-4 ".concat(t," ").concat(n," ").concat(l),children:i})}function Modal(e){let{heading:t,closeModal:n,children:l}=e;return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"relative max-h-[calc(100vh-10rem)] overflow-y-auto overflow-x-hidden min-w-[17rem] flex flex-col items-center bg-neutral-50 rounded max-w-full m-1",children:[(0,a.jsxs)("h2",{className:"relative w-full bg-neutral-300 font-bold text-black px-2 py-2",children:[(0,a.jsx)(HeaderFooterContentWrapper,{borderColour:"border-neutral-400",padding:"pl-2",margins:"ml-1",children:t}),(0,a.jsx)(CloseButton,{close:n})]}),(0,a.jsx)("div",{className:"flex flex-col w-[280px] max-w-full px-4 pb-4 text-sm",children:l})]})})}function CloseButton(e){let{close:t,extraCSS:n}=e;return n=null!=n?n:"top-2 right-2",(0,a.jsxs)("button",{className:"absolute font-bold [&_svg]:fill-neutral-500 [&_svg]:hover:fill-neutral-400 "+n,onClick:t,children:[(0,a.jsx)(IconClose,{size:"20"}),(0,a.jsx)("span",{className:"sr-only",children:"close"})]})}function ModalLegend(e){let{children:t}=e;return(0,a.jsx)("legend",{className:"pl-2 font-semibold mb-4 text-base",children:t})}function ModalFieldsWrapper(e){let{children:t}=e;return(0,a.jsx)("div",{className:"pt-6 pb-10",children:t})}function ModalSubmitButton(e){let{label:t,extraCSS:n,disabled:l}=e;return(0,a.jsx)(Button,{extraCSS:n,colours:"primary",size:"default",disabled:l,children:null!=t?t:"submit"})}function Radio(e){let{extraCSS:t,children:n,...l}=e;return(0,a.jsxs)("label",{className:t,children:[(0,a.jsx)("input",{type:"radio",className:"sr-only",...l}),n]})}function ModalProdSettings(e){let{closeModal:t,initialProdSettings:n,currentSwitches:l,updateProdSettings:i,levels:r,nowModalProps:s}=e,[o,u]=(0,d.useState)(function(e,t){let n=utils_deepCopy(b);for(let[l,i]of Object.entries(e)){let e=t.findIndex(e=>e.key===l),r=i;-1!==e&&(r=t[e].to),n[l]=r}return n}(n,l)),c=function(){let[e,t]=(0,d.useState)(new Date);return(0,d.useEffect)(()=>{let e=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(e)},[]),e}(),p=function(e){let{nowModalProps:t,timeNow:n}=e,l=!1;if(void 0!==t&&void 0!==t.firstTimeGroup){let e=t.firstTimeGroup.timeID-1-2,i=convertDateToTimeID(n,t.gameState);l=i>=e}return l}({nowModalProps:s,timeNow:c});function handleChange(e,t){u(n=>({...n,[e]:t}))}return(0,a.jsxs)(Modal,{heading:"Production Settings",closeModal:t,children:[void 0===s?null:p?(0,a.jsx)(NotificationAtTop,{message:"Too close to the time of the first upgrade. Please update game status.",mode:"error"}):void 0===s.firstTimeGroup?(0,a.jsx)(NotificationAtTop,{message:"All upgrades are purchased, so changing production settings here will have no effect.",mode:"attention"}):(0,a.jsx)(MessageForNow,{firstTimeGroup:s.firstTimeGroup,timeNow:c}),(0,a.jsxs)("form",{onSubmit:function(){i(o),t()},className:"flex flex-col w-full",children:[(0,a.jsx)(ModalFieldsWrapper,{children:(0,a.jsx)("div",{className:"flex flex-col items-center gap-6 my-1 mx-2",children:Object.keys(n).map(e=>(0,a.jsx)(ProductionToggle,{myKey:e,toggledTo:o[e],handleSelection:handleChange,disabled:p||0===r[e]},e))})}),(0,a.jsx)(ModalSubmitButton,{label:"set",extraCSS:"",disabled:p})]})]})}function ProductionToggle(e){let{myKey:t,toggledTo:n,handleSelection:l,disabled:i}=e,r=getWorkerOutputsFromJSON(t);if(null===r)return null;let s=r.length;return 1===s?null:(0,a.jsxs)("fieldset",{className:"w-full relative flex justify-end",children:[(0,a.jsxs)("legend",{className:"absolute top-0 left-0 mb-1 flex items-center gap-2 block"+(i?" text-gray-300":""),children:[(0,a.jsx)("span",{className:"w-14 font-semibold",children:capitalise(t)}),(0,a.jsx)("span",{className:"sr-only",children:"is producing"}),i?(0,a.jsx)("span",{children:"n/a"}):(0,a.jsx)(CurrentAsCircleBadge,{type:n})]}),(0,a.jsx)("div",{className:"flex w-24",children:r.map((e,r)=>(0,a.jsx)(Radio,{extraCSS:"w-2/4",checked:e===n,disabled:!1,onChange:()=>l(t,e),value:"".concat(t,"_").concat(e),name:"productionSettings",children:(0,a.jsx)(ToggleDisplay,{thisOption:e,activeOption:n,roundLeft:0===r,roundRight:r===s-1,disabled:i})},"".concat(t,"_").concat(e)))})]})}function CurrentAsCircleBadge(e){let{type:t}=e,n=m[t];return(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"inline-block w-3 h-3 rounded-full border "+n.badge}),(0,a.jsx)("span",{className:"pl-1",children:t})]})}function ToggleDisplay(e){let{thisOption:t,activeOption:n,roundLeft:l,roundRight:i,disabled:r}=e,s=m[t],o=r?"":s.hover;return(0,a.jsx)("div",{className:"duration-75 ease-linear flex justify-center content-center border-2 "+s.badge+" "+((l?"rounded-l-full":i?"rounded-r-full":"")+" ")+(r?"opacity-10":t!==n?"opacity-30":"")+" "+o,children:t.charAt(0).toLowerCase()})}function NotificationAtTop(e){let{message:t,mode:n}=e;return(0,a.jsx)("p",{className:"mt-5 py-1 text-xs border-l-4 shadow px-2 ".concat("error"===n?"border-red-600 bg-white":"border-amber-500 bg-amber-50"),children:t})}function MessageForNow(e){let{firstTimeGroup:t,timeNow:n}=e;return void 0===t?(0,a.jsx)(NotificationAtTop,{message:"An error has occurred. Try refreshing the page or updating the game status.",mode:"error"}):(0,a.jsxs)("p",{className:"mt-5 text-sm flex flex-col items-center gap-1 bg-white rounded py-2",children:["Adjusting settings starting from",(0,a.jsx)("span",{className:"block font-semibold inline rounded px-1.5 py-0.5 bg-violet-100",children:calcDateWithTimeDisplayStr(n)})]})}function moveIsValid(e){let t,{srcIdx:n,dstIdx:l,purchaseData:i}=e;if(-1===n||-1===l)return{isValid:!1,reason:"Upgrade does not exist"};if(n>l){for(let e=n-1;e>=l;e--)if(!(t=swapIsValidWithReason({idxBefore:n,idxAfter:e,purchaseData:i})).isValid)return t}else if(n<l){for(let e=n+1;e<=l;e++)if(!(t=swapIsValidWithReason({idxBefore:e,idxAfter:n,purchaseData:i})).isValid)return t}return{isValid:!0}}function swapIsValidWithReason(e){let{idxBefore:t,idxAfter:n,purchaseData:l}=e;function getCheckData(e){let t=l[e],n=f[t.key],i=n.upgrades[t.level-1];return{key:t.key,level:t.level,name:n.name,prereq:"prereq"in i?i.prereq:"",costs:i.costs}}let i=getCheckData(t),r=getCheckData(n);if(i.key===r.key&&i.level>=r.level)return{isValid:!1,reason:"".concat(i.name," lv").concat(i.level," can't be purchased before lv").concat(r.level)};if(i.prereq===r.key&&1===r.level)return{isValid:!1,reason:"".concat(i.name," lv ").concat(i.level," can't be purchased before ").concat(r.name," lv 1")};if(i.costs.length>0)for(let e=0;e<i.costs.length;e++){let t=i.costs[e].egg,n=f[t];if("firstCreatedBy"in n&&n.firstCreatedBy===r.key&&1===r.level)return{isValid:!1,reason:"".concat(i.name," lv ").concat(i.level," requires ").concat(n.name.toLowerCase()," eggs")}}return{isValid:!0}}function BadgeCost(e){let{data:t,extraCSS:n}=e,l=toThousands(parseInt(t.quantity));return n=null!=n?n:"justify-between items-center px-2 py-0.5 rounded text-xs",(0,a.jsxs)("span",{className:"flex "+n+" "+m[t.egg].badge,children:[(0,a.jsx)("span",{className:"block mr-1",children:t.egg.charAt(0)}),(0,a.jsx)("span",{className:"block",children:l})]})}function BadgeMaxed(e){let{extraCSS:t}=e;return(0,a.jsx)("div",{className:"flex items-center text-xs px-2 rounded border font-bold "+c+" "+t,children:"Maxed"})}function StockpilesDisplay(e){let{stockpiles:t,extraCSS:n}=e;return(0,a.jsxs)("div",{className:"flex ".concat(n),children:[(0,a.jsx)("p",{className:"sr-only",children:"Egg Stockpiles"}),(0,a.jsx)(Stockpile,{myKey:"blue",data:t}),(0,a.jsx)(Stockpile,{myKey:"green",data:t}),(0,a.jsx)(Stockpile,{myKey:"red",data:t}),(0,a.jsx)(Stockpile,{myKey:"yellow",data:t})]})}function Stockpile(e){let{myKey:t,data:n}=e;return(0,a.jsxs)("div",{className:"flex justify-between text-sm w-1/4 px-1 gap-1 rounded ".concat(m[t].badge),children:[(0,a.jsx)("div",{children:t.charAt(0).toLowerCase()}),(0,a.jsx)("div",{children:toThousands(n[t])})]})}function Tooltip(e){let{close:t,posAndWidthCSS:n,children:l}=e;return n=null!=n?n:"top-0.5 right-8 z-30 w-11/12",(0,a.jsx)("button",{className:"absolute border-2 border-neutral-300 bg-neutral-50 text-neutral-900 shadow-lg rounded-md [max-width:90vw] py-2 px-3 "+n,onClick:t,type:"button",children:l})}function UpgradePickerModal(e){let{closeModal:t,movePlanElement:n,pickerTargetIdx:l,purchaseData:i,gameState:r}=e,[s,o]=(0,d.useState)(null!=l?l:-1),u=function(e){let{targetIdx:t,purchaseData:n,gameState:l}=e,i=[],r=0===t?l.levels:n[t].levelsAbove;for(let[e,t]of Object.entries(f)){let l=r[e],s=t.upgrades.length,a=l+1,o=a>s?-1:n.findIndex(t=>t.key===e&&t.level===a);i.push({key:e,fromIdx:o,name:t.name,level:a,isMaxLevel:s<a,costs:s<a?[]:t.upgrades[a-1].costs})}return i}({targetIdx:null!=l?l:-1,purchaseData:i,gameState:r});if(null!==l)return(0,a.jsx)(Modal,{heading:"Upgrade Picker",closeModal:t,children:(0,a.jsxs)("form",{className:"flex flex-col items-center h-auto",onSubmit:function(e){e.preventDefault(),n({oldIdx:s,newIdx:null!=l?l:-1}),t()},children:[(0,a.jsx)("fieldset",{className:"flex flex-col w-full",children:(0,a.jsxs)(ModalFieldsWrapper,{children:[(0,a.jsxs)(ModalLegend,{children:["Pick an upgrade for Position ",l+1]}),(0,a.jsx)("div",{className:"flex flex-col px-2",children:u.map((e,t)=>{let n=!1===moveIsValid({srcIdx:e.fromIdx,dstIdx:l,purchaseData:i}).isValid,{key:r,fromIdx:u,...d}=e;return(0,a.jsx)(UpgradeRadio,{checked:u===s,myKey:r,data:d,handleSelection:()=>o(u),disabled:n},t)})})]})}),(0,a.jsxs)("div",{className:"flex w-full justify-between relative",children:[(0,a.jsx)(ModalSubmitButton,{label:"pick",disabled:!1,extraCSS:""}),(0,a.jsx)(MoreInfo,{stockpiles:function(e){let t=utils_deepCopy(e.stockpiles),n=getProductionCostsFromJSON(e.key,e.level);for(let e=0;e<n.length;e++){let l=n[e].egg;t[l]=t[l]+parseInt(n[e].quantity)}return t}(i[l])})]})]})})}function MoreInfo(e){let{stockpiles:t}=e,[n,l]=(0,d.useState)(!1);return(0,a.jsxs)("div",{className:"flex justify-end",children:[(0,a.jsx)(InfoButton,{showMore:n,setShowMore:l,modeKey:"primary"}),n?(0,a.jsx)(Tooltip,{posAndWidthCSS:"bottom-1 right-8 z-30 w-11/12",close:()=>l(!1),children:(0,a.jsx)(StockpilesSection,{stockpiles:t})}):null]})}function StockpilesSection(e){let{stockpiles:t}=e;return(0,a.jsxs)("section",{className:"text-left",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Current stockpiles"}),(0,a.jsx)("div",{className:"my-1",children:(0,a.jsx)(StockpilesDisplay,{stockpiles:t,extraCSS:"overflow-hidden gap-1"})})]})}function UpgradeRadio(e){let{checked:t,myKey:n,data:l,handleSelection:i,disabled:r}=e;return(0,a.jsx)(Radio,{checked:t,disabled:r,onChange:i,value:n,name:"upgradePicker",children:(0,a.jsx)(UnitPickerCard,{checked:t,disabled:r,data:l})})}function UnitPickerCard(e){let{checked:t,disabled:n,data:l}=e,[i,r]=(0,d.useState)(!1);return(0,a.jsxs)("div",{className:"ease-linear duration-75 flex border m-1 items-center rounded "+(t?"bg-violet-100 border-violet-500":n?"bg-transparent border-neutral-100 text-neutral-200":"bg-neutral-200 border-neutral-300 hover:bg-violet-50 hover:border-violet-300"),onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[(0,a.jsx)("div",{className:"ease-linear duration-75 w-3 h-3 ml-2 border rounded-full "+(t?"bg-violet-500 border-violet-500":i&&!n?"bg-violet-300 border-violet-400":n?"bg-neutral-50 border-neutral-100":"bg-white border-neutral-400")}),(0,a.jsxs)("div",{className:"grid grid-cols-[4.25rem_1.75rem_1fr] mr-5",children:[(0,a.jsx)("span",{className:"block text-sm ml-2 px-1 flex items-center",children:l.name}),(0,a.jsx)("span",{className:"block text-sm p-1 font-bold flex items-center",children:l.isMaxLevel?" ":l.level}),(0,a.jsx)("div",{className:"flex gap-1 py-1 "+(n?"opacity-10":""),children:l.isMaxLevel?(0,a.jsx)(BadgeMaxed,{extraCSS:void 0}):null===l.costs||0===l.costs.length?"free":l.costs.map((e,t)=>(0,a.jsx)(BadgeCost,{data:e,extraCSS:void 0},t))})]})]})}function UpgradeCard(e){let{data:t,pos:n,openUpgradePicker:l,isDuringOfflinePeriod:i}=e,r=f[t.key],s=r.name,o=r.upgrades[t.level-1].costs,u=n-1,d=4320<t.purchaseTimeID?"bg-gray-100 border-gray-200 text-gray-300":i?"bg-gray-50 border-greyBlue-300":"bg-gray-100 border-gray-200";return(0,a.jsxs)("div",{className:"flex gap-1 items-stretch",children:[(0,a.jsx)(Button,{size:"pos",colours:"primary",extraCSS:"flex items-center justify-center w-8",onClick:()=>l(u),children:n}),(0,a.jsx)("button",{onClick:()=>l(u),children:(0,a.jsxs)("div",{className:"w-52 flex items-center text-black px-1.5 py-0.5 gap-3.5 border ".concat(d),children:[(0,a.jsx)("span",{className:"w-10 block text-sm flex items-center",children:s}),(0,a.jsx)("span",{className:"w-5 block text-sm font-bold flex items-center justify-center",children:t.level}),(0,a.jsx)("div",{className:"flex gap-1",children:null===o||0===o.length?(0,a.jsx)("div",{className:"text-sm",children:1===t.level?"free":"n/a"}):o.map((e,t)=>(0,a.jsx)(BadgeCost,{data:e,extraCSS:void 0},t))})]})})]})}function calcTimeDustDone(e,t,n){let l=Math.round((1e10-t)/e),i=n+l;return i<4321?i:-1}function TimeGroupMoreSubheading(e){let{text:t}=e;return(0,a.jsx)("h4",{className:"text-xs self-start font-bold",children:t})}function SideHeading(e){let{extraCSS:t,children:n}=e;return t=void 0===t?"":" "+t,(0,a.jsx)("th",{className:"font-medium px-1 bg-neutral-100 text-black border border-neutral-300"+t,children:n})}function InfoButtonInHeader(e){let{tooltipProps:t}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:t.onClick,className:"rounded-full w-4 h-4 bg-violet-500 hover:opacity-80 text-white text-xs font-semibold font-serif leading-none flex items-center justify-center",children:"i"}),t.isVisible?(0,a.jsx)(Tooltip,{close:t.close,posAndWidthCSS:"bottom-5 left-2 text-left w-64",children:t.message}):null]})}function useAtEndInfoTooltip(e){let[t,n]=(0,d.useState)(!1);return{isVisible:t,message:"Assuming ad boost remains ".concat(e.current?"active":"inactive"," and no further upgrades are purchased"),onClick:()=>n(e=>!e),close:()=>{n(!1)}}}function ProductionTableSection(e){let{moreData:t,gameState:n,leftHeadingWidth:l}=e,i=(0,d.useRef)();i.current=n.premiumInfo.adBoost;let r=useAtEndInfoTooltip(i);return(0,a.jsxs)("section",{children:[(0,a.jsx)(TimeGroupMoreSubheading,{text:"Eggs"}),(0,a.jsxs)("table",{className:"text-xs border-collapse",children:[(0,a.jsx)(ProductionTableHead,{moreData:t}),(0,a.jsxs)("tbody",{className:"",children:[(0,a.jsx)(ProductionTableRow,{headingStr:"stockpile",data:t.eggStockpiles,formatData:e=>e>1e4?toThousands(e):e.toLocaleString(),leftHeadingWidth:l}),(0,a.jsx)(ProductionTableRow,{headingStr:"rate p/m",data:t.eggRates,formatData:e=>Math.round(e).toLocaleString(),leftHeadingWidth:l}),(0,a.jsx)(ProductionTableRow,{headingStr:"at end",data:t.eggsTotalAtEnd,formatData:toThousands,leftHeadingWidth:l,tooltipProps:r}),(0,a.jsx)(ProductionTableRow,{headingStr:"needed",data:t.eggsSpendRemaining,formatData:toThousands,leftHeadingWidth:l}),(0,a.jsx)(ProductionTableRow,{headingStr:"finish @",data:t.eggsDoneAt,formatData:e=>(function(e,t){if(-1===e)return"-";if(0===e)return"done";let n=convertTimeIDToDate(e,t);return["".concat(n.getDate()),"".concat(n.getHours().toString().padStart(2,"0"),":").concat(n.getMinutes().toString().padStart(2,"0"))]})(e,n),leftHeadingWidth:l})]})]})]})}function ProductionTableHead(e){let{moreData:t}=e;return(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{}),Object.keys(t.eggStockpiles).map(e=>{let t="yellow"===e?"font-bold":"font-medium";return(0,a.jsx)("th",{className:"border w-12 "+m[e].badge+" "+t,children:e.charAt(0)},e)})]})})}function ProductionTableRow(e){let{headingStr:t,data:n,formatData:l,leftHeadingWidth:i,tooltipProps:r}=e;function handleFormattedData(e){if(void 0===l)return"";let t=l(n[e]);return"string"==typeof t?t:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:t[0].padStart(2,"0")}),(0,a.jsx)("div",{children:t[1]})]})}return(0,a.jsx)(ProductionTableRowWrapper,{headingStr:t,leftHeadingWidth:i,tooltipProps:r,children:Object.keys(n).map(e=>{if("dust"===e)return null;let t=l?handleFormattedData(e):n[e].toLocaleString();return(0,a.jsx)(ProductionTableCell,{extraCSS:m[e].cell+" "+("done"===t?"text-center":"text-right"),children:l?handleFormattedData(e):n[e].toLocaleString()},e)})})}function ProductionTableRowWrapper(e){let{headingStr:t,leftHeadingWidth:n,tooltipProps:l,children:i}=e;return(0,a.jsxs)("tr",{className:"relative z-0",children:[(0,a.jsx)(SideHeading,{extraCSS:"text-xs pr-1 text-right "+n,children:(0,a.jsxs)("div",{className:"flex flex-row-reverse justify-between",children:[t,void 0!==l?(0,a.jsx)(InfoButtonInHeader,{tooltipProps:l}):null]})}),i]})}function ProductionTableCell(e){let{extraCSS:t,children:n}=e;return(0,a.jsx)("td",{className:"px-1 border text-xs text-black "+t,children:n})}function DustStatsSection(e){let{moreData:t,gameState:n,leftHeadingWidth:l}=e,i=(0,d.useRef)();i.current=n.premiumInfo.adBoost;let r=useAtEndInfoTooltip(i),s=t.dustRates.map(e=>e.toLocaleString()),o=t.dustTotals.map(e=>e.toLocaleString()),u=t.dustFinishTimes.map(e=>{let t,l,i,r;return -1===e?"-":(l=(t=convertTimeIDToDate(e,n)).getDate().toString().padStart(2,"0"),i="".concat(t.getHours().toString().padStart(2,"0"),":").concat(t.getMinutes().toString().padStart(2,"0")),r=convertTimeIDToTimeRemaining(4320-e),"".concat(calcDHMString(r)," ").concat(l).concat(nbsp()).concat(calcMonthName(t.getMonth())).concat(nbsp()).concat(i))});return(0,a.jsxs)("section",{children:[(0,a.jsx)(TimeGroupMoreSubheading,{text:"Dust"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 mt-1",children:[(0,a.jsxs)(DustRowWrapper,{children:[(0,a.jsx)(DustSubheading,{leftHeadingWidth:l,children:"stockpile"}),(0,a.jsxs)("div",{className:"font-medium flex flex-col items-end justify-center w-48 px-1 py-0.5 border-l-4 ".concat(m.dust.field),children:["".concat(t.dustNow.toLocaleString()),"\xa0","(".concat(toBillions(t.dustNow),")")]})]}),(0,a.jsx)(DustRowWrapper,{children:(0,a.jsxs)("table",{className:"w-full border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:l}),(0,a.jsx)("th",{className:"w-24 text-center border bg-neutral-300 border-neutral-400 text-black",children:"current"}),(0,a.jsx)("th",{className:"w-24 text-center border ".concat(m.dust.badge),children:"max\xa0dust"})]})}),(0,a.jsxs)("tbody",{children:[(0,a.jsx)(DustTableRow,{heading:"rate".concat(nbsp(),"p/m"),data:s}),(0,a.jsx)(DustTableRow,{heading:"at".concat(nbsp(),"end"),data:o,tooltipProps:r}),(0,a.jsx)(DustTableRow,{heading:"1st".concat(nbsp(),"prize").concat(nbsp(),"@"),data:u})]})]})})]})]})}function DustTableRow(e){let{data:t,heading:n,tooltipProps:l}=e;return(0,a.jsxs)("tr",{className:"relative z-0",children:[(0,a.jsx)(SideHeading,{children:(0,a.jsxs)("div",{className:"flex flex-row-reverse justify-between",children:[(0,a.jsx)("span",{children:n}),void 0!==l?(0,a.jsx)(InfoButtonInHeader,{tooltipProps:l}):null]})}),t.map((e,t)=>{let n=1===t?m.dust.cell:"bg-neutral-50 border-neutral-300 text-black";return(0,a.jsx)("td",{className:"px-1 border "+n,children:e},t)})]})}function DustRowWrapper(e){let{children:t}=e;return(0,a.jsx)("div",{className:"flex text-xs text-right",children:t})}function DustSubheading(e){let{leftHeadingWidth:t,children:n}=e;return(0,a.jsx)("h5",{className:"text-xs pr-2 font-medium flex items-center justify-end "+t,children:n})}function ProductionSettingsSummary(e){let{productionSettings:t,levels:n,extraCSS:l,wantHeadings:i,isDuringOfflinePeriod:r}=e;return(0,a.jsx)("div",{className:"flex w-40 "+l,children:Object.keys(t).map((e,l)=>{let s=0===n[e],o=s?r?"border-greyBlue-300 text-greyBlue-400 bg-greyBlue-50":"border-greyBlue-200 text-greyBlue-200":m[t[e]].badge;return o=0===l?o+" border-l":o,(0,a.jsxs)("div",{className:"w-5 flex flex-col justify-center text-xs",children:[i?(0,a.jsx)("div",{className:"flex items-center justify-center",children:e.charAt(0).toUpperCase()+e.charAt(1)}):null,(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"flex items-center justify-center border-r border-t border-b "+o,children:s?"-":t[e].charAt(0).toLowerCase()})})]},l)})})}function ProductionSettingsSection(e){let{productionSettings:t,levels:n,isDuringOfflinePeriod:l,leftHeadingWidth:i}=e;return(0,a.jsxs)("section",{className:"py-1 flex flex-col gap-1",children:[(0,a.jsx)(TimeGroupMoreSubheading,{text:"Current Settings"}),(0,a.jsx)(ProductionSettingsSummary,{productionSettings:t,levels:n,extraCSS:"w-20"===i?"ml-20":"",wantHeadings:!0,isDuringOfflinePeriod:l})]})}function TimeGroupMore(e){let{data:t,remainingTimeGroups:n,gameState:l,borderColour:i,isDuringOfflinePeriod:r}=e,s=function(e,t,n){var l,i;let r=calcProductionRates(e.levelsAtEnd,n.premiumInfo,e.productionSettingsDuring),s=function(e){let t={blue:0,green:0,red:0,yellow:0};return e.reduce((e,n)=>{let l=n.upgrades.reduce((e,t)=>{let n=getUpgradeDataFromJSON(t.key,t.level);for(let t=0;t<n.costs.length;t++){let l=n.costs[t].egg;e[l]+=parseInt(n.costs[t].quantity)}return e},utils_deepCopy(t));for(let[t,n]of Object.entries(l))e[t]+=n;return e},utils_deepCopy(t))}(t),a=utils_deepCopy(e.stockpilesAtEnd);delete a.dust;let o=function(e,t,n){let l=4320-n;return{blue:Math.floor(l*e.blue)+t.blue,green:Math.floor(l*e.green)+t.green,red:Math.floor(l*e.red)+t.red,yellow:Math.floor(l*e.yellow)+t.yellow}}(r,e.stockpilesAtEnd,e.timeID),u=(l=e.stockpilesAtEnd,i=e.timeID,Object.keys(s).reduce((e,t)=>{let n=o[t],a=l[t],u=s[t],d=r[t];return{...e,[t]:n<u?-1:a>=u?0:Math.round((u-a)/d)+i}},{blue:-1,green:-1,red:-1,yellow:-1})),d=function(e,t,n,l,i){let r=calcMaxDustRate(t,n),s=calcTimeDustDone(e,l,i),a=calcTimeDustDone(r,l,i),o=4320-i,u=Math.round(o*e)+l,d=Math.round(o*r)+l;return{dustRates:[Math.round(e),Math.round(r)],dustFinishTimes:[s,a],dustTotals:[u,d]}}(r.dust,utils_deepCopy(e.levelsAtEnd),n.premiumInfo,e.stockpilesAtEnd.dust,e.timeID),{dust:c,...p}=r;return{eggStockpiles:a,eggRates:p,eggsTotalAtEnd:o,eggsDoneAt:u,eggsSpendRemaining:s,dustNow:e.stockpilesAtEnd.dust,...d}}(t,n,l),o="w-20";return(0,a.jsxs)("section",{className:"flex flex-col gap-5 border-l border-r px-2 pb-4 "+i+" "+(r?"bg-greyBlue-100 text-black":"bg-white"),children:[(0,a.jsx)("div",{className:"-mb-2 "+(r?"":"border-b border-gray-200 mt-2")}),(0,a.jsx)(ProductionSettingsSection,{productionSettings:t.productionSettingsDuring,levels:t.levelsAtEnd,leftHeadingWidth:o,isDuringOfflinePeriod:r}),(0,a.jsx)(DustStatsSection,{moreData:s,gameState:l,leftHeadingWidth:o}),(0,a.jsx)(ProductionTableSection,{moreData:s,gameState:l,leftHeadingWidth:o})]})}function TimeGroup(e){let{groupData:t,startPos:n,openUpgradePicker:l,gameState:i,remainingGroups:r}=e,[s,o]=(0,d.useState)(!1),u=null!==t.startOfflinePeriodTimeID,c=u?"border-greyBlue-300":"border-neutral-200";return(0,a.jsxs)("div",{className:"flex flex-col mt-1 border-b border-t shadow w-72 "+(u?"bg-greyBlue-200":"bg-white")+" "+c,children:[(0,a.jsx)("div",{className:"flex justify-center pt-1 px-1 border-l border-r "+c,children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(UpdateCardContainer,{upgrades:t.upgrades,startPos:n,isDuringOfflinePeriod:u,openUpgradePicker:l}),(0,a.jsx)("div",{className:"self-end pb-2 pl-1",children:(0,a.jsx)(MoreButton,{showMore:s,setShowMore:o,modeKey:u?"moreOffline":"more"})})]})}),s?(0,a.jsx)(TimeGroupMore,{data:t,remainingTimeGroups:r,gameState:i,borderColour:c,isDuringOfflinePeriod:u}):null]})}function UpdateCardContainer(e){let{upgrades:t,startPos:n,isDuringOfflinePeriod:l,openUpgradePicker:i}=e;return(0,a.jsx)("div",{className:"flex flex-col gap-1 pt-1.5 pb-2",children:t.map((e,t)=>(0,a.jsx)(UpgradeCard,{data:e,pos:n+t,openUpgradePicker:i,isDuringOfflinePeriod:l},e.readyTimeID+"_"+e.key+"_"+e.level))})}function ProductionSwitchButton(e){let{nameKey:t,setTo:n,handleClick:l}=e;return null===n||null===t?(0,a.jsx)(Button,{size:"planner",colours:"secondary",onClick:l,extraCSS:"plnMd:self-end",children:"switch"}):(0,a.jsx)(ResourceSwitchButton,{setTo:n,nameKey:t,handleClick:l})}function ResourceSwitchButton(e){let{setTo:t,nameKey:n,handleClick:l}=e,i=m[t].badge+" "+m[t].hover;return(0,a.jsxs)("button",{className:"flex plnMd:justify-between text-sm items-center px-2 py-0.5 rounded border-2 mb-1  "+i,onClick:l,children:[(0,a.jsx)("div",{className:"w-10 plnMd:w-16 plnMd:flex plnMd:justify-start",children:null!==n?capitalise(n):"Worker"}),(0,a.jsxs)("div",{className:"px-4",children:[(0,a.jsx)("svg",{width:"10.000001",height:"16.000015",viewBox:"0 0 2.6458335 4.2333376","aria-hidden":"true",children:(0,a.jsx)("g",{transform:"translate(-1.8166475,-2.9104147)",children:(0,a.jsx)("text",{style:ReactifyInkscapeStyle("fill:".concat("dust"===t||"yellow"===t?"#000":"#FFF",";font-size:8.77772px;line-height:1.25;font-family:Roboto;-inkscape-font-specification:Roboto;display:inline;stroke-width:0.548606")),x:"-5.9744253",y:"-1.6983222",id:"text1435",transform:"scale(-0.80590153,-1.2408464)",children:(0,a.jsx)("tspan",{x:"-5.9744253",y:"-1.6983222",style:ReactifyInkscapeStyle("stroke-width:0.548606"),children:"\xab"})})})}),(0,a.jsx)("span",{className:"sr-only",children:"to "})]}),(0,a.jsx)("div",{className:"plnMd:w-16 plnMd:flex plnMd:justify-end",children:t})]})}function ControlsRow(e){let{displaySwitches:t,showUpgradeButton:n,handleProductionClick:l,handleUpgradeClick:i}=e,r=0===t.length?"w-20":"w-40";return(0,a.jsxs)("div",{className:"w-full plnMd:w-min flex justify-between px-1 py-1 plnMd:justify-start plnMd:grid plnMd:gap-1 plnMd:grid-rows-1 plnMd:[grid-template-columns:18rem_auto]",children:[n?(0,a.jsx)("div",{className:"flex flex-col justify-start plnMd:[grid-column-start:1] plnMd:justify-self-start plnMd:self-start",children:(0,a.jsx)(Button,{size:"planner",colours:"primary",onClick:i,extraCSS:"flex items-center justify-center my-0.5",children:"insert\xa0\xbb"})}):null,(0,a.jsx)("div",{className:"flex flex-col [padding-top:2px] plnMd:[grid-column-start:2] plnMd:w-40 "+r,children:0===t.length?(0,a.jsx)(ProductionSwitchButton,{nameKey:null,setTo:null,handleClick:l}):t.map((e,t)=>(0,a.jsx)(ProductionSwitchButton,{nameKey:e.key,setTo:e.to,handleClick:l},"prodToggle_"+e.key+"_"+t))})]})}function PlannerFooter(e){let{unboughtUpgrades:t}=e;return(0,a.jsx)("div",{className:"".concat(p.plannerHeaderFooterBgAndText," py-4 flex flex-col items-start mt-2 w-full border-t-2 ").concat(p.mainAsBorder),children:(0,a.jsxs)(HeaderFooterContentWrapper,{padding:"pl-3 py-1",margins:"ml-2 md:ml-4 mr-4",children:[(0,a.jsx)("h3",{className:"text-xl font-bold",children:"Time's up"}),(0,a.jsx)("p",{className:"text-sm",children:0===t?"All upgrades purchased":"".concat(t," upgrades unpurchased")})]})})}function ResultAtTop(e){let{gameState:t,actions:n,timeIDGroups:l}=e,i=function(e){let{gameState:t,actions:n,timeIDGroups:l}=e,{timeRemaining:i,stockpiles:r,levels:s,productionSettings:a}=function(e){let{gameState:t,actions:n,timeIDGroups:l}=e,i=findIndexLastTimeGroupInTime(l);if(-1===i)return{timeRemaining:t.timeRemaining,stockpiles:t.stockpiles,levels:t.levels,productionSettings:calcProductionSettingsBeforeIndex({actions:n,index:null})};let r=l[i],s=utils_deepCopy(r.productionSettingsDuring);if(r.switches.length>0)for(let e=0;e<r.switches.length;e++){let t=r.switches[e];s[t.key]=t.to}return{timeRemaining:4320-r.timeID,stockpiles:r.stockpilesAtEnd,levels:r.levelsAtEnd,productionSettings:s}}({gameState:t,actions:n,timeIDGroups:l}),o=function(e){let{timeRemaining:t,stockpiles:n,levels:l,premiumInfo:i,productionSettings:r}=e;return calcStockpilesAdvancedByTime(n,t,calcProductionRates(l,i,r))}({timeRemaining:i,stockpiles:r,levels:s,premiumInfo:t.premiumInfo,productionSettings:a}),u=null===o?-1:o.dust,d=l.length>1||1===l.length&&l[0].timeID<4321,c=d?function(e){let{timeIDGroups:t,dustAtEnd:n}=e,l=function(e){let t=findIndexLastTimeGroupInTime(e),n=e.slice(0,t+1),l=Math.max(...n.map(e=>null!==e.allToDustAfter?e.allToDustAfter.value:0)),i=n.findIndex(e=>null!==e.allToDustAfter&&l===e.allToDustAfter.value),r=e[i];return{max:l,pos:r.startPos+r.upgrades.length-1}}(t);return l.max>n?{dust:l.max,position:l.pos}:null}({timeIDGroups:l,dustAtEnd:u}):function(e){let{gameState:t,stockpiles:n,levels:l,productionSettings:i}=e,r=calcDustAtEndWithMaxDustProduction({timeID:convertDateToTimeID(t.timeEntered,t),stockpiles:n,levels:l,premiumInfo:t.premiumInfo,productionSettings:i});return{dust:r.value,position:-1}}({gameState:t,stockpiles:r,levels:s,productionSettings:a});return{hasWon:u>=1e10,dustAtEnd:u,allToDust:c}}({gameState:t,actions:n,timeIDGroups:l});return(0,a.jsx)("div",{className:"sticky z-10 ".concat(g," md:[top:calc(7.25rem_+_1px)] w-full ").concat(p.mainAsBg," mb-4 shadow-md"),children:(0,a.jsx)("div",{className:"".concat(p.plannerHeaderFooterBgAndText," mt-1 md:rounded-t w-full py-2 flex flex-col items-start "),children:(0,a.jsxs)(HeaderFooterContentWrapper,{borderColour:i.hasWon?"border-green-600":"border-red-600",padding:i.hasWon?"pl-3 py-1":"pl-3 md:pl-4 py-1",margins:"mx-4",children:[(0,a.jsxs)("div",{className:"font-bold text-lg",children:[i.hasWon?"":"Not enough for ",(0,a.jsx)("span",{className:"ordinal",children:"1st"})," prize",i.hasWon?" is yours!":""]}),(0,a.jsx)("div",{className:"text-sm",children:null===i.allToDust?(0,a.jsx)(Result,{dustAtEnd:i.dustAtEnd}):(0,a.jsx)(ResultWithRec,{dustAtEnd:i.dustAtEnd,suggestionData:i.allToDust})})]})})})}function Result(e){let{dustAtEnd:t}=e;return(0,a.jsxs)("div",{className:"text-base",children:[t.toLocaleString()," ","(".concat(toBillions(t),")")]})}function ResultWithRec(e){let{dustAtEnd:t,suggestionData:n}=e,[l,i]=(0,d.useState)(!1),r={isVisible:l,setVisibility:i,position:n.position};return(0,a.jsxs)("div",{className:"relative flex flex-col",children:[(0,a.jsx)(ResultWithRecRow,{label:"now",quantity:t}),(0,a.jsx)(ResultWithRecRow,{label:"rec.",quantity:n.dust,suggestionProps:r})]})}function ResultWithRecRow(e){let{label:t,quantity:n,suggestionProps:l}=e;return(0,a.jsxs)("div",{className:"grid grid-rows-1 [grid-template-columns:4rem_minmax(0,_1fr)_3rem_1.75rem]",children:[(0,a.jsx)("div",{className:"font-semibold",children:t}),(0,a.jsx)("div",{className:"text-right",children:n.toLocaleString()}),(0,a.jsx)("div",{className:"text-right",children:"(".concat(toBillions(n),")")}),void 0!==l?(0,a.jsxs)("div",{className:"text-right relative",children:[(0,a.jsx)("button",{onClick:()=>l.setVisibility(e=>!e),className:"rounded-full w-5 h-5 text-center bg-white hover:opacity-90 font-bold text-sm ".concat("text-neutral-700"),children:"?"}),void 0!==l&&l.isVisible?(0,a.jsx)(Tooltip,{posAndWidthCSS:"-top-9 right-0",close:()=>l.setVisibility(!1),children:(0,a.jsxs)("div",{className:"text-xs font-medium min-w-max",children:["Switch all to dust after position ",l.position]})}):null]}):null]})}function NoPlannerWrapper(e){let{mode:t,children:n}=e;return(0,a.jsx)("div",{className:"py-4 px-3 w-full bg-white rounded-l",children:(0,a.jsx)("div",{className:"border-l-4 pl-4 pr-8 pt-4 pb-10  "+("error"===t?"border-red-600":"border-white"),children:n})})}function NoPlannerHeading(e){let{children:t}=e;return(0,a.jsx)("h2",{className:"text-xl font-bold w-full py-2 mb-2",children:t})}function AllUpgradesPurchased(){return(0,a.jsxs)(NoPlannerWrapper,{mode:"done",children:[(0,a.jsx)(NoPlannerHeading,{children:"All Upgrades Purchased"}),(0,a.jsx)("p",{children:"You've done all you can, I hope the planner helped. Enjoy your prize! \uD83D\uDE04"}),(0,a.jsxs)("div",{className:"mt-8 border-l-4 border-amber-500 bg-amber-50 rounded px-3 py-3 grid [grid-template-columns:2.5rem_auto] items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{"aria-hidden":!0,className:"flex items-center justify-center leading-none h-6 w-6 rounded-full bg-amber-300 text-amber-800 text-lg font-bold mr-3",children:"!"}),(0,a.jsx)("span",{className:"sr-only",children:"Warning:"})]}),(0,a.jsx)("span",{className:"justify-self-start",children:"Don't forget to switch everyone to dust production!"})]})]})}function TimeGroupHeading(e){var t;let{data:n,gameState:l}=e,[i,r]=(0,d.useState)(!1),[s,o]=(0,d.useState)(!1),u=convertTimeIDToTimeRemaining(4320-n.timeID),c=convertTimeIDToDate(n.timeID,l),p=null!==n.startOfflinePeriodTimeID,g=null!==n.startOfflinePeriodTimeID?convertTimeIDToDate(n.startOfflinePeriodTimeID,l):null,m=calcDateWithTimeDisplayStr(c),f=null!==g?calcDateWithTimeDisplayStr(g)+" - "+m:m;return(0,a.jsxs)("h3",{className:"w-full flex items-center justify-between px-1 rounded-sm "+(p?"bg-greyBlue-500 border-greyBlue-600 text-white border-2":"border-neutral-200 text-black border-b-2"),children:[(0,a.jsx)("div",{children:calcDHMString(u)}),null===g?(0,a.jsx)("div",{suppressHydrationWarning:!0,children:m}):(0,a.jsxs)(a.Fragment,{children:[i?null:(0,a.jsx)("div",{children:(t=t=s?"#dde6ff":"#fff",(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 6.35 6.3499999",children:(0,a.jsx)("g",{transform:"translate(-39.999999,-39.999999)",children:(0,a.jsx)("path",{style:ReactifyInkscapeStyle("opacity:0.998235;fill:".concat(t,";stroke-width:0.004;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none")),d:"m 43.174999,39.999999 c -1.753504,0 -3.175,1.421496 -3.175,3.175 0,1.753504 1.421496,3.175 3.175,3.175 0.436999,-2.17e-4 0.869249,-0.09064 1.26969,-0.265617 -1.348694,-0.399006 -2.274148,-1.637781 -2.27428,-3.044259 2.73e-4,-1.262323 0.748318,-2.404577 1.90531,-2.909383 -0.292403,-0.08661 -0.595759,-0.130644 -0.90072,-0.130741 z"})})}))}),(0,a.jsx)("button",{suppressHydrationWarning:!0,className:"hover:text-greyBlue-100 plnMd:hidden "+(p&&i?"text-sm":""),onClick:()=>r(e=>!e),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:i?f:m}),(0,a.jsx)("div",{className:"text-sm hidden plnMd:block",suppressHydrationWarning:!0,children:f})]})]})}function Planner(e){let{timeIDGroups:t,gameState:n,actions:l,setActions:i,purchaseData:r,prodSettingsNow:s,setProdSettingsNow:o,prodSettingsBeforeNow:u}=e,c=r.filter(e=>e.readyTimeID<4320).length,g=null!==s?s.productionSettings:0===t.length?b:t[0].productionSettingsDuring,m=(0,d.useRef)();m.current=u;let{openModal:f,props:x}=function(e){let{purchaseData:t,actions:n,setActions:l}=e,[i,r]=(0,d.useState)(!1),[s,a]=(0,d.useState)(null);return{openModal:function(e){a(e),r(!0)},props:{showModal:i,closeModal:()=>r(!1),movePlanElement:function(e){let{oldIdx:i,newIdx:r}=e,s=moveIsValid({srcIdx:i,dstIdx:r,purchaseData:t}),a=t[i].actionsIdx,o=t[r].actionsIdx;if(s.isValid){let e=utils_deepCopy(n),t=e[a];e.splice(a,1),e.splice(o,0,t),l(e)}else console.log("TODO: response to invalid move (".concat(s.reason,")"))},pickerTargetIdx:s}}}({purchaseData:r,actions:l,setActions:i}),{openModal:h,props:y}=function(e){let{actions:t,setActions:n}=e,[l,i]=(0,d.useState)(!1),[r,s]=(0,d.useState)(null);return{openModal:function(e){s(e),i(!0)},props:{isVisible:l,closeModal:()=>i(!1),data:r,updateProdSettings:function(e){if(null===r)return;let l=utils_deepCopy(t),i=0;r.switches.length>0&&(l=function(e){let{timeGroupData:t,workingActions:n}=e,l=t.switches[0].actionsIdx,i=t.switches[t.switches.length-1].actionsIdx;return n.filter((e,t)=>t<l||t>i||"upgrade"===e.type)}({timeGroupData:r,workingActions:l}),i=function(e){let{timeGroupData:t}=e,n=0;if(t.upgrades.length>1){let e=t.upgrades[0].actionsIdx,l=t.upgrades[t.upgrades.length-1].actionsIdx;for(let i=0;i<t.switches.length;i++){let i=t.switches[0];e<i.actionsIdx&&i.actionsIdx<l&&(n+=1)}}return n}({timeGroupData:r}));let s=r.upgrades[r.upgrades.length-1].actionsIdx+1-i,a=function(e){let{startSettings:t,newSettings:n,insertIdx:l}=e,i=[],r=0;for(let[e,s]of Object.entries(n))if(s!==t[e]){let t={type:"switch",key:e,to:s,actionsIdx:l+r};i.push(t),r++}return i}({startSettings:r.productionSettingsDuring,newSettings:e,insertIdx:s});n(l=l.slice(0,s).concat(a).concat(l.slice(s)))}}}}({actions:l,setActions:i}),{openModal:v,props:S}=function(e){let{initialProdSettings:t,setProdSettingsNow:n,gameState:l,timeIDGroups:i,prodSettingsBeforeNowRef:r}=e,[s,a]=(0,d.useState)(!1);return{openModal:()=>a(!0),props:{isVisible:s,closeModal:()=>a(!1),initialProdSettings:t,updateProdSettings:function(e){if(void 0!==r.current&&function(e,t){for(let[n,l]of Object.entries(e))if(t[n]!==l)return!1;return!0}(e,r.current)){n(null);return}n({productionSettings:e,timeID:convertDateToTimeID(new Date,l)})},levelsAtStart:l.levels,modalProps:{firstTimeGroup:i.length>0?i[0]:void 0,gameState:l}}}}({initialProdSettings:g,setProdSettingsNow:o,gameState:n,timeIDGroups:t,prodSettingsBeforeNowRef:m});return(0,a.jsxs)("div",{className:"flex flex-col items-center ".concat(p.panelBg),children:[(0,a.jsx)(ResultAtTop,{planData:r,gameState:n,actions:l,timeIDGroups:t}),0===t.length?(0,a.jsx)(AllUpgradesPurchased,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Modals,{purchaseData:r,gameState:n,upgradePickerProps:x,switchProdFutureProps:y,switchProdNowProps:S}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 w-full px-1 sm:px-4 items-center",children:[n.levels.trinity>0?(0,a.jsx)(ControlsRow,{displaySwitches:null===s?[]:function(e){let{startSettings:t,newSettings:n}=e,l=[];for(let[e,i]of Object.entries(n))if(i!==t[e]){let t={key:e,to:i};l.push(t)}return l}({startSettings:u,newSettings:s.productionSettings}),handleProductionClick:v,handleUpgradeClick:()=>f(0),showUpgradeButton:!0}):null,(0,a.jsx)(TimeGroupsList,{gameState:n,timeIDGroups:t,openUpgradePicker:f,openProdSwitcherModal:h,purchasesPassTimeLimit:c<r.length})]}),null!==r&&r.length>0?(0,a.jsx)(PlannerFooter,{unboughtUpgrades:r.length-c}):null]})]})}function Modals(e){let{purchaseData:t,gameState:n,upgradePickerProps:l,switchProdFutureProps:i,switchProdNowProps:r}=e;return l.showModal?(0,a.jsx)(UpgradePickerModal,{closeModal:l.closeModal,movePlanElement:l.movePlanElement,pickerTargetIdx:l.pickerTargetIdx,purchaseData:t,gameState:n}):i.isVisible&&null!==i.data?(0,a.jsx)(ModalProdSettings,{closeModal:i.closeModal,initialProdSettings:i.data.productionSettingsDuring,currentSwitches:i.data.switches,updateProdSettings:i.updateProdSettings,levels:i.data.levelsAtEnd}):r.isVisible?(0,a.jsx)(ModalProdSettings,{closeModal:r.closeModal,initialProdSettings:r.initialProdSettings,currentSwitches:[],updateProdSettings:r.updateProdSettings,levels:r.levelsAtStart,nowModalProps:r.modalProps}):null}function TimeGroupsList(e){let{timeIDGroups:t,gameState:n,openUpgradePicker:l,openProdSwitcherModal:i,purchasesPassTimeLimit:r}=e;return(0,a.jsx)(a.Fragment,{children:t.map((e,s)=>{if(e.timeID>4320){let t=e.upgrades[0],{costs:n,costsWithZeroRate:l}=function(e){let{rates:t,targetUpgrade:n}=e,l=getProductionCostsFromJSON(n.key,n.level),i=l.filter(e=>0===t[e.egg]);return{costs:l,costsWithZeroRate:i}}({rates:e.ratesDuring,targetUpgrade:t});return l.length>0?(0,a.jsx)("div",{className:"w-full border-l-[4px] border-amber-400 bg-amber-50 text-black my-3 px-4 py-5 text-sm",children:(0,a.jsx)(InsufficientProductionMessage,{targetUpgrade:t,costs:n,costsWithZeroRate:l})},"nextUpgradeIsImpossibleWarningThingKey"):null}let o=e.switches.filter(t=>e.productionSettingsDuring[t.key]!==t.to),u=null!==e.startOfflinePeriodTimeID?"bg-black bg-opacity-5 rounded-b":"",d=e.startPos+e.upgrades.length;return(0,a.jsxs)("div",{className:"w-full flex flex-col items-center "+u,children:[(0,a.jsx)(TimeGroupHeading,{data:e,gameState:n}),(0,a.jsxs)("div",{className:"w-min",children:[(0,a.jsx)(TimeGroup,{groupData:e,startPos:e.startPos,openUpgradePicker:l,gameState:n,remainingGroups:t.slice(s+1)}),(0,a.jsx)(ControlsRow,{displaySwitches:o,handleProductionClick:()=>i(e),handleUpgradeClick:()=>l(d-1),showUpgradeButton:s<t.length-1||r})]})]},"tgcr"+s)})})}function InsufficientProductionMessage(e){let{targetUpgrade:t,costs:n,costsWithZeroRate:l}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{children:["Your next upgrade, ",(0,a.jsxs)("span",{className:"font-semibold",children:[capitalise(t.key),"\xa0",t.level]}),", costs ",(0,a.jsx)("span",{className:"inline-block",children:(0,a.jsx)("span",{className:"flex gap-1",children:n.map(e=>(0,a.jsx)(BadgeCost,{data:e,extraCSS:"justify-between max-w-max px-2 py-0.5 rounded text-xs"},"failedPurchaseCost".concat(e.egg)))})})," but your production of ".concat(1===l.length?"".concat(l[0].egg):"both ".concat(l[0].egg," and ").concat(l[1].egg)," \n                    eggs is zero.")]}),(0,a.jsx)("p",{className:"mt-4",children:"Try switching your workers to producing ".concat(l[0].egg).concat(1===l.length?"":" and ".concat(l[1].egg)," eggs or select a different upgrade.")})]})}function ModalSave(e){let{closeModal:t,saveInputs:n,convertToKeyName:l}=e,{showOverwrite:i,setShowOverwrite:r,name:s,handleChange:o,saveAndClose:u,handleSubmit:c,showWarning:p}=function(e){let{closeModal:t,saveInputs:n,convertToKeyName:l}=e,[i,r]=(0,d.useState)(""),[s,a]=(0,d.useState)(!1),[o,u]=(0,d.useState)(!1);function saveAndClose(){n(i),t()}return{showOverwrite:o,setShowOverwrite:u,name:i,handleChange:function(e){let t=e.target.value.replace(/[^a-zA-Z0-9_]/g,"");l(t) in Object.keys(localStorage)?a(!0):a(!1),r(t)},saveAndClose,handleSubmit:function(){Object.keys(localStorage).includes(l(i))?u(!0):saveAndClose()},showWarning:s}}({closeModal:t,saveInputs:n,convertToKeyName:l});return(0,a.jsx)(Modal,{heading:i?"Warning":"Save Plan",closeModal:t,children:i?(0,a.jsx)(OverwriteQuestion,{name:s,goBack:()=>r(!1),acceptOverwrite:u}):(0,a.jsx)(SaveForm,{name:s,handleChange:o,showWarning:p,handleSubmit:c})})}function SaveForm(e){let{name:t,handleChange:n,showWarning:l,handleSubmit:i}=e,r=(0,d.useId)();return(0,a.jsxs)("form",{onSubmit:()=>i(),children:[(0,a.jsx)(ModalFieldsWrapper,{children:(0,a.jsxs)("div",{className:"flex flex-col gap-1 mx-1",children:[(0,a.jsx)("label",{htmlFor:r,children:"Save as"}),(0,a.jsx)("input",{className:"px-2 py-1 border border-neutral-200",type:"text",id:r,value:t,onChange:e=>n(e)}),l?(0,a.jsxs)("p",{children:['!: There is already a save called "',t,'"']}):null]})}),(0,a.jsx)(ModalSubmitButton,{label:"save",extraCSS:"",disabled:!1})]})}function OverwriteQuestion(e){let{name:t,goBack:n,acceptOverwrite:l}=e;return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)(ModalFieldsWrapper,{children:(0,a.jsxs)("p",{children:['There is already a save called "',t,'".']})}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(Button,{size:"twin",colours:"secondary",onClick:()=>n(),children:"\xab\xa0back"}),(0,a.jsx)(Button,{size:"twin",colours:"primary",onClick:()=>l(),children:"overwrite\xa0\xbb"})]})]})}function calcOptionsForNumberRange(e,t){let n=[];for(let l=e;l<=t;l++){let e=l.toString();n.push({valueStr:e,displayStr:e.padStart(2,"0")})}return n}function Select(e){let{id:t,selectExtraCSS:n,options:l,handleChange:i,initValue:r}=e;return r=null===r?void 0:r,(0,a.jsx)("select",{id:t,onChange:e=>i(e),defaultValue:r,className:"border border-neutral-300 rounded-sm ".concat(n),children:l.map((e,t)=>(0,a.jsx)(Option,{valueStr:e.valueStr,displayStr:e.displayStr},t))})}function SelectWithLabel(e){let{id:t,labelExtraCSS:n,selectExtraCSS:l,labelDisplay:i,options:r,handleChange:s,initValue:o}=e;return o=null===o?void 0:o,(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("label",{className:n,htmlFor:t,children:i}),(0,a.jsx)(Select,{id:t,selectExtraCSS:l,options:r,handleChange:s,initValue:o})]})}function SelectWithSRLabel(e){let{id:t,selectExtraCSS:n,options:l,handleChange:i,initValue:r,visualLabel:s,srLabel:o,extraCSS:u}=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:t,className:"text-sm "+u,children:[(0,a.jsx)("span",{className:"sr-only",children:o}),(0,a.jsx)("span",{"aria-hidden":!0,children:s})]}),(0,a.jsx)(Select,{id:t,selectExtraCSS:n,options:l,handleChange:i,initValue:r})]})}function SelectHours(e){let{id:t,handleChange:n,initValue:l}=e;return(0,a.jsx)(SelectWithSRLabel,{id:t,selectExtraCSS:void 0,handleChange:e=>n(e),initValue:l,options:calcOptionsForNumberRange(0,23),visualLabel:"",srLabel:"time: hour",extraCSS:"px-1"})}function SelectMinutes(e){let{id:t,handleChange:n,initValue:l}=e;return(0,a.jsx)(SelectWithSRLabel,{id:t,selectExtraCSS:void 0,handleChange:e=>n(e),initValue:l,options:calcOptionsForNumberRange(0,59),visualLabel:":",srLabel:"time: minute",extraCSS:"px-1"})}function Option(e){let{valueStr:t,displayStr:n}=e;return(0,a.jsx)("option",{value:t,children:n})}function ModalLoad(e){let{closeModal:t,loadInputs:n,loadOptions:l,reset:i}=e,r=l(),[s,o]=(0,d.useState)(null===r?null:r[0].valueStr),u=(0,a.jsx)(ResetButton,{handleClick:()=>{i(),t()}}),c=(0,d.useId)();return(0,a.jsx)(Modal,{heading:"Load Plan",closeModal:t,children:null===r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ModalFieldsWrapper,{children:(0,a.jsx)("p",{children:"There are no saved plans"})}),u]}):(0,a.jsxs)("form",{onSubmit:()=>void(null!==s&&(n(s),t())),children:[(0,a.jsx)(ModalFieldsWrapper,{children:(0,a.jsx)("div",{className:"flex flex-col gap-1 mx-1",children:(0,a.jsx)(SelectWithLabel,{id:c,selectExtraCSS:"px-2 py-1",labelDisplay:"Plan to load",options:r,handleChange:function(e){o(e.target.value)},initValue:r[0].valueStr,labelExtraCSS:void 0})})}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(ModalSubmitButton,{label:"load",extraCSS:"",disabled:!1}),u]})]})})}function ResetButton(e){let{handleClick:t}=e;return(0,a.jsx)(Button,{size:"twin",colours:"warning",htmlType:"button",onClick:t,children:"reset all"})}function useAdBoost(e){let{gameState:t}=e,[n,l]=(0,d.useState)(t.premiumInfo.adBoost);return{hasAdBoost:n,toggleAdBoost:function(){l(e=>!e)}}}function formatSelectValueStr(e,t){return"".concat(e.toLowerCase(),"_").concat(t.toString())}function calcLevelKeyValue(e){let t=e.target.value,n=t.split("_"),l=n[0];l=l.toLowerCase();let i=parseInt(n[1]);return{key:l,value:i}}function FieldsetWrapper(e){let{children:t}=e;return(0,a.jsx)("fieldset",{className:"relative rounded-sm max-w-full w-11/12 pb-2 border border-violet-200 bg-violet-50 bg-opacity-40",children:t})}function AllEggs(e){let{gameState:t,handleLevelChange:n}=e;return(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(Label,{htmlFor:"id_AllEggs",children:"All Eggs"}),(0,a.jsx)(Select,{selectExtraCSS:void 0,id:"id_AllEggs",initValue:null===t?void 0:formatSelectValueStr("All",t.premiumInfo.allEggs),options:getUpgradeOptions({name:"All",max:5}),handleChange:n})]})}function Checkbox(e){let{checked:t,disabled:n,onChange:l,idStr:i,name:r,displayText:s,value:o}=e;return(0,a.jsxs)("label",{className:"flex gap-2 items-center",children:[(0,a.jsx)("input",{hidden:!0,checked:t,type:"checkbox",disabled:n,id:i,name:r,value:o,onChange:l}),(0,a.jsx)("span",{className:"block w-20 ml-2 text-black font-semibold",children:s}),(0,a.jsx)("span",{className:"ease-in duration-100 rounded w-5 h-5 flex items-center justify-center border ".concat(t?"bg-violet-600 border-violet-800":"bg-white border-neutral-300"),children:t?(0,a.jsx)(IconCheck,{size:"16",colour:"white"}):null})]})}function AdBoost(e){let{hasAdBoost:t,toggleAdBoost:n}=e;return(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)(Checkbox,{checked:t,onChange:n,disabled:!1,idStr:"id_adBoost",name:"adBoost",displayText:"Ad Boost",value:"adBoost"})})}function InputGeneral(e){let{timeRemaining:t,setTimeRemaining:n,timeEntered:l,setStateOnChange:i,setTimeEntered:r,gameState:s,handleLevelChange:o,hasAdBoost:u,toggleAdBoost:d}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-6 mt-2",children:[(0,a.jsx)(TimeRemainingFieldset,{timeRemaining:t,setTimeRemaining:n}),(0,a.jsx)(Entered,{timeEntered:l,setStateOnChange:i,setTimeEntered:r}),(0,a.jsx)(AllEggs,{gameState:s,handleLevelChange:o}),(0,a.jsx)(AdBoost,{hasAdBoost:u,toggleAdBoost:d})]})}function Entered(e){let{timeEntered:t,setStateOnChange:n,setTimeEntered:l}=e;return t=null!=t?t:new Date,(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(Label,{htmlFor:"id_timeEntered",children:"Entered"}),(0,a.jsx)(Button,{htmlType:"button",onClick:()=>{l(new Date)},colours:"secondary",size:"inline",extraCSS:"w-min",children:"now"}),(0,a.jsx)("p",{suppressHydrationWarning:!0,className:"ml-2",children:calcDateWithTimeDisplayStr(t)}),(0,a.jsx)("input",{hidden:!0,type:"datetime-local",id:"id_timeEntered",value:"".concat(t),onChange:e=>n(e,l)})]})}function TimeRemainingFieldset(e){let{timeRemaining:t,setTimeRemaining:n}=e,{isError:l,message:i,handleChangeDays:r,handleChangeHours:s,handleChangeMinutes:o}=function(e){let{timeRemaining:t,setTimeRemaining:n}=e,[l,i]=(0,d.useState)(!1),[r,s]=(0,d.useState)("");return{isError:l,message:r,handleChangeDays:function(e){let r=parseInt(e.target.value);if(3===(r=function(e){let n="days can be 0 - ".concat(3);return e>3?(s(n),i(!0),e=3):3===e&&(t.hours>0||t.minutes>0)?(i(!0),s("".concat(3," days is the maximum: hours and minutes set to 0"))):e<0?(i(!0),s(n),e=0):l&&i(!1),e}(r))){n({days:3,hours:0,minutes:0});return}n(e=>({...e,days:r}))},handleChangeHours:function(e){let l=parseInt(e.target.value);l=function(e){let n="hours can be 0 - ".concat(23," (inclusive)");return 3===t.days&&0!==e?(i(!0),s("can't go above ".concat(3," days")),e=0):e>23?(i(!0),s(n),e=23):e<0?(i(!0),s(n),e=0):i(!1),e}(l),n(e=>({...e,hours:l}))},handleChangeMinutes:function(e){let l=parseInt(e.target.value);l=function(e){let n="minutes can be 0 - ".concat(59);return 3===t.days&&0!==e?(i(!0),s("can't go above ".concat(3," days")),e=0):e>59?(i(!0),s(n),e=59):e<0?(i(!0),s(n),e=0):i(!1),e}(l),n(e=>({...e,minutes:l}))}}}({timeRemaining:t,setTimeRemaining:n});return(0,a.jsxs)(FieldsetWrapper,{children:[(0,a.jsx)(Label,{extraCSS:"font-semibold w-min px-1",htmlFor:"",tagName:"legend",children:"Time\xa0Remaining"}),(0,a.jsxs)("div",{className:"w-full relative flex flex-col items-center gap-1 px-2",children:[(0,a.jsxs)("div",{className:"w-full flex gap-2 py-1 px-2 rounded-md",children:[(0,a.jsx)(TimeRemainingUnit,{unitName:"days",value:null==t?0:t.days,handleChange:r}),(0,a.jsx)(TimeRemainingUnit,{unitName:"hours",value:null==t?0:t.hours,handleChange:s}),(0,a.jsx)(TimeRemainingUnit,{unitName:"minutes",value:null==t?0:t.minutes,handleChange:o})]}),l?(0,a.jsx)("div",{"data-testid":"timeRemainingInputErrorMessage",className:"text-xs border-1 text-neutral-700 px-1 py-1 w-56",children:capitalise(i)}):null]})]})}function TimeRemainingUnit(e){let{unitName:t,value:n,handleChange:l}=e;isNaN(n)&&(n=0);let i="id_".concat(t);return(0,a.jsxs)("div",{className:"flex items-center justify-items-stretch w-1/3",children:[(0,a.jsx)(InputNumberAsText,{cssStr:"w-12 pl-1 bg-white",idStr:i,value:n,handleChange:l}),(0,a.jsx)("label",{className:"pl-1 pr-2 w-4",htmlFor:i,children:t.charAt(0)})]})}function InputStockpiles(e){let{controlledStockpileValue:t,updateStockpiles:n}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)(DustInput,{controlledStockpileValue:t,updateStockpiles:n}),["blue","green","red","yellow"].map(e=>(0,a.jsx)(StockpileInput,{keyId:e,controlledStockpileValue:t,updateStockpiles:n},e))]})}function StockpileWrapper(e){let{coloursCSS:t,idStr:n,label:l,children:i}=e;return(0,a.jsxs)("div",{className:"rounded ml-2 flex py-1 px-2 items-center border ".concat(t),children:[(0,a.jsx)("label",{className:"block w-20",htmlFor:n,children:l}),i]})}function StockpileInput(e){let{keyId:t,controlledStockpileValue:n,updateStockpiles:l}=e,i="id_".concat(t,"Stock"),r="".concat(t.charAt(0).toUpperCase()).concat(t.slice(1)),s=extractBorderColourCSS(m[t].badge);return(0,a.jsx)(StockpileWrapper,{coloursCSS:m[t].badge,label:r,idStr:i,children:(0,a.jsx)(InputNumberAsText,{cssStr:"w-36 text-black py-1 px-2 font-normal ".concat(s),idStr:i,value:n(t),handleChange:e=>l(e,t)})})}function DustInput(e){let{controlledStockpileValue:t,updateStockpiles:n}=e,l=extractBorderColourCSS(m.dust.badge);return(0,a.jsx)(StockpileWrapper,{coloursCSS:m.dust.badge,label:"Dust",idStr:"id_dust",children:(0,a.jsx)(InputNumberAsText,{idStr:"id_dust",cssStr:"w-36 py-1 px-2 font-normal ".concat(l),value:t("dust"),handleChange:e=>n(e,"dust")})})}function extractBorderColourCSS(e){let t=e.match(/border-\w*-\d{2,3}/g);return null===t?"":t[0]}function InputLevelsWorkers(e){let{gameState:t,levels:n,handleLevelChange:l}=e;return(0,a.jsx)(LevelsWrapper,{children:[{id:"id_Trinity",labelDisplay:"Trinity",optionsProps:{name:"Trinity",max:10}},{id:"id_Bronte",labelDisplay:"Bronte",optionsProps:{name:"Bronte",max:10}},{id:"id_Anne",labelDisplay:"Anne",optionsProps:{name:"Anne",max:8}},{id:"id_Petra",labelDisplay:"Petra",optionsProps:{name:"Petra",max:10}},{id:"id_Manny",labelDisplay:"Manny",optionsProps:{name:"Manny",max:10}},{id:"id_Tony",labelDisplay:"Tony",optionsProps:{name:"Tony",max:10}},{id:"id_Ruth",labelDisplay:"Ruth",optionsProps:{name:"Ruth",max:8}},{id:"id_Rex",labelDisplay:"Rex",optionsProps:{name:"Rex",max:10}}].map(e=>{let i=getInitValueForLevelSelect(e.optionsProps.name,t),r=e.optionsProps.name.toLowerCase();return(0,a.jsx)(UnitLevelInput,{keyName:r,idStr:e.id,labelStr:e.labelDisplay,initValue:i,options:getUpgradeOptions(e.optionsProps),handleLevelChange:l,currentValue:n[r]},e.id)})})}function InputLevelsOther(e){let{gameState:t,levels:n,handleLevelChange:l}=e,i=[{valueStr:"Speed_0",displayStr:"0%"},{valueStr:"Speed_1",displayStr:"-5%"},{valueStr:"Speed_2",displayStr:"-10%"},{valueStr:"Speed_3",displayStr:"-15%"},{valueStr:"Speed_4",displayStr:"-20%"},{valueStr:"Speed_5",displayStr:"-25%"}],r=[{valueStr:"Dust_0",displayStr:"0%"},{valueStr:"Dust_1",displayStr:"25%"},{valueStr:"Dust_2",displayStr:"50%"},{valueStr:"Dust_3",displayStr:"75%"},{valueStr:"Dust_4",displayStr:"100%"},{valueStr:"Dust_5",displayStr:"125%"},{valueStr:"Dust_6",displayStr:"150%"}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(SubSection,{heading:"Egg Levels",extraCSS:"mt-0",children:[{id:"id_BlueLevel",labelDisplay:"Blue",optionsProps:{name:"Blue",max:4}},{id:"id_GreenLevel",labelDisplay:"Green",optionsProps:{name:"Green",max:3}},{id:"id_RedLevel",labelDisplay:"Red",optionsProps:{name:"Red",max:2}},{id:"id_YellowLevel",labelDisplay:"Yellow",optionsProps:{name:"Yellow",max:1}}].map(e=>{let i=getInitValueForLevelSelect(e.optionsProps.name,t),r=e.optionsProps.name.toLowerCase();return(0,a.jsx)(UnitLevelInput,{keyName:r,idStr:e.id,labelStr:e.labelDisplay,initValue:i,options:getUpgradeOptions(e.optionsProps),handleLevelChange:l,currentValue:n[r]},"".concat(e.id,"EggLevelField"))})}),(0,a.jsxs)(SubSection,{heading:"Buff Levels",children:[(0,a.jsx)(UnitLevelInput,{keyName:"speed",idStr:"id_speedLevel",labelStr:"Speed",initValue:null===t?void 0:i[t.levels.speed].valueStr,options:i,handleLevelChange:l,currentValue:n.speed}),(0,a.jsx)(UnitLevelInput,{keyName:"dust",idStr:"id_dustLevel",labelStr:"Dust",initValue:null===t?void 0:r[t.levels.dust].valueStr,options:r,handleLevelChange:l,currentValue:n.dust})]})]})}function SubSection(e){let{heading:t,extraCSS:n,children:l}=e;return(0,a.jsxs)("section",{className:null!=n?n:"mt-7",children:[(0,a.jsx)("h3",{className:"font-semibold pb-3",children:t}),(0,a.jsx)(LevelsWrapper,{children:l})]})}function FormActiveMode(e){let{gameState:t,setGameState:n,changeMode:l,wantBackToMode:i,closeModal:r}=e,{onSubmit:s,levels:o,handleLevelChange:u,hasAdBoost:c,toggleAdBoost:p,timeEntered:g,setTimeEntered:m,timeRemaining:f,setTimeRemaining:x,controlledStockpileValue:b,updateStockpiles:S,setStateOnChange:j}=function(e){let{gameState:t,setGameState:n,closeModal:l}=e,[i,r]=(0,d.useState)(new Date),[s,a]=(0,d.useState)(null===t?h:function(e){let t,n=Math.floor(e/60/24);if(3===n)return{days:3,hours:0,minutes:0};let l=e-1440*n;return t=l%60,{days:n,hours:(l-t)/60,minutes:t}}(t.timeRemaining)),[o,u]=(0,d.useState)(null===t?0:t.premiumInfo.allEggs),[c,p]=(0,d.useState)(null===t?utils_deepCopy(y):t.stockpiles),[g,m]=(0,d.useState)(null===t?utils_deepCopy(v):t.levels),{hasAdBoost:f,toggleAdBoost:x}=useAdBoost({gameState:t});return{onSubmit:function(e){e.preventDefault(),n(function(){let e=convertTimeRemainingToMinutes(s),t=function(e){let{timeEntered:t,timeRemaining:n}=e;return 4320===n?t:new Date(t.getTime()-(4320-n)*6e4)}({timeEntered:i,timeRemaining:e});return{startTime:t,timeEntered:i,timeRemaining:e,premiumInfo:{adBoost:f,allEggs:o},stockpiles:c,levels:g}}()),l()},hasAdBoost:f,toggleAdBoost:x,timeEntered:i,setStateOnChange:function(e,t){t(e.target.value)},setTimeEntered:r,timeRemaining:s,setTimeRemaining:a,levels:g,handleLevelChange:function(e){let{key:t,value:n}=calcLevelKeyValue(e),l=function(e,t){if("all"===e)return t<0?0:t>5?5:t;let n=getMainKeysFromJSON();if(t>0&&n.includes(e)){let n=getUpgradesDataFromJSON(e).length;return t>n?n:t}return 0}(t,n);if("all"===t){u(l);return}let i=utils_deepCopy(g);t in i&&(i[t]=l),m(i)},controlledStockpileValue:function(e){if(!(e in c))return"";let t=c[e];return null===t?"":t},updateStockpiles:function(e,t){let n=utils_deepCopy(c);n[t]=parseInt(e.target.value),p(n)}}}({setGameState:n,gameState:t,closeModal:r}),T=(0,d.useRef)();T.current=i;let{activePage:w,maxPage:N,changePage:D,wantDisableBack:C}=function(e){let{wantBackToModeSetter:t,changeMode:n}=e,[l,i]=(0,d.useState)(1);return{activePage:l,maxPage:4,changePage:function(e){0===e&&t.current?n():e>0&&e<=4&&i(e)},wantDisableBack:function(e){return 0===e&&!t.current}}}({wantBackToModeSetter:T,changeMode:l});return(0,a.jsxs)("form",{onSubmit:e=>s(e),children:[(0,a.jsx)(InputPageWrapper,{isVisible:1===w,children:(0,a.jsx)(InputGeneral,{timeEntered:g,setStateOnChange:j,setTimeEntered:m,timeRemaining:f,setTimeRemaining:x,gameState:t,handleLevelChange:u,hasAdBoost:c,toggleAdBoost:p})}),(0,a.jsx)(InputPageWrapper,{isVisible:2===w,heading:"Current Stockpiles",children:(0,a.jsx)(InputStockpiles,{controlledStockpileValue:b,updateStockpiles:S})}),(0,a.jsx)(InputPageWrapper,{isVisible:3===w,heading:"Worker Levels",children:(0,a.jsx)(InputLevelsWorkers,{handleLevelChange:u,gameState:t,levels:o})}),(0,a.jsx)(InputPageWrapper,{isVisible:w===N,children:(0,a.jsx)(InputLevelsOther,{handleLevelChange:u,gameState:t,levels:o})}),(0,a.jsx)(PageNav,{activePage:w,changePage:D,numPages:N,submitLabel:"enter",wantDisableBack:C}),(0,a.jsx)(ModalSubmitButton,{label:"submit",extraCSS:"sr-only [padding:0] [height:0]",disabled:!1})]})}function PageNav(e){let{activePage:t,numPages:n,changePage:l,submitLabel:i,wantDisableBack:r}=e;return(0,a.jsxs)("div",{"aria-hidden":!0,className:"flex flex-col justify-center gap-5",children:[(0,a.jsx)(NavButtonBox,{activePage:t,numPages:n,changePage:l,submitLabel:i,wantDisableBack:r}),(0,a.jsx)(ProgressStatus,{activePage:t,numPages:n,changePage:l})]})}function NavButtonBox(e){let{activePage:t,numPages:n,changePage:l,submitLabel:i,wantDisableBack:r}=e,s=t===n;return(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"flex justify-between w-full",children:[(0,a.jsx)(Button,{colours:"secondary",htmlType:"button",size:"twin",onClick:()=>l(t-1),disabled:r(t-1),children:"\xab\xa0back"}),s?(0,a.jsx)(Button,{colours:"primary",htmlType:"submit",size:"twin",onClick:void 0,disabled:!1,extraCSS:"border-2",children:null!=i?i:"submit"},"submitBtn"):(0,a.jsx)(Button,{colours:"primary",htmlType:"button",size:"twin",onClick:()=>l(t+1),disabled:s,extraCSS:"border-2",children:"next\xa0\xbb"},"nextBtn")]})})}function ProgressStatus(e){let{activePage:t,numPages:n,changePage:l}=e;return(0,a.jsx)("div",{"aria-hidden":!0,className:"w-full flex gap-4 justify-center",children:Array.from({length:(n-1)/1+1},(e,t)=>1+1*t).map(e=>(0,a.jsx)(CircleButton,{isActive:t===e,text:"page ".concat(e),handleClick:()=>l(e)},"formProgBtn".concat(e)))})}function CircleButton(e){let{isActive:t,text:n,handleClick:l}=e;return(0,a.jsx)("button",{type:"button",className:"rounded-full w-3 h-3 "+(t?"bg-violet-500":"bg-neutral-300 hover:bg-neutral-400"),onClick:l,children:(0,a.jsx)("span",{className:"sr-only",children:n})})}function FormSetMode(e){let{mode:t,setMode:n,close:l}=e,[i,s]=(0,d.useState)(null),o=null===i&&t===r.plan||i===r.plan,u=null===i&&t===r.active||i===r.active,c="setMode";return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),null!==i&&n(i),l()},children:[(0,a.jsx)(InputPageWrapper,{isVisible:!0,children:(0,a.jsxs)("fieldset",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("legend",{className:"flex flex-col mb-5 ml-1",children:[(0,a.jsx)("span",{className:"font-bold text-base",children:"Select input mode"}),(0,a.jsx)("span",{className:"font-medium text-sm text-neutral-600",children:"(you can change this later)"})]}),(0,a.jsx)(Radio,{checked:o,disabled:!1,onChange:()=>s(r.plan),value:"planMode",name:c,children:(0,a.jsx)(OptionBox,{title:"Plan",description:"Work out a plan in advance",bullets:["Try different start times","Skip inputting in-progress details"],isSelected:o})}),(0,a.jsx)(Radio,{checked:u,disabled:!1,onChange:()=>s(r.active),value:"activeMode",name:c,children:(0,a.jsx)(OptionBox,{title:"Active",description:"Event is running now: view and adjust your plan as you go",bullets:["Skip inputting start time","Update time remaining, dust, eggs and upgrade levels as necessary"],isSelected:u})})]})}),(0,a.jsx)(Button,{size:"default",colours:"primary",htmlType:"submit",disabled:t!==r.active&&t!==r.plan&&null===i,children:"next\xa0\xbb"},"mode_set")]})}function OptionBox(e){let{title:t,description:n,bullets:l,isSelected:i}=e,[r,s]=(0,d.useState)(!1);return(0,a.jsxs)("div",{className:"ease-linear duration-75 border-2 rounded px-[0.875rem] pt-3 pb-5 ".concat(i?"border-violet-500 bg-violet-100":"border-gray-300 hover:bg-violet-50 hover:border-violet-300"," hover:border-violet-"),onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[(0,a.jsx)("h4",{className:"font-semibold text-base",children:t}),(0,a.jsx)("p",{className:"mt-2 text-sm",children:n}),(0,a.jsx)("hr",{className:"ease-linear duration-75 my-4 border-t ".concat(i?"border-violet-400":r?"border-violet-300":"border-gray-300")}),(0,a.jsx)("ul",{className:"list-disc ml-5 text-xs",children:l.map((e,t)=>(0,a.jsx)("li",{className:"mt-1",children:e},"".concat(t,"_").concat(e.substring(0,3),"_").concat(e.substring(-3))))})]})}function FormPlanMode(e){let{gameState:t,setGameState:n,closeModal:l,isInitialisingMode:i}=e,{onSubmit:r,setAllEggs:s,hasAdBoost:o,toggleAdBoost:u,startTime:c,setStartTime:p}=function(e){let{gameState:t,setGameState:n,closeModal:l}=e,[i,r]=(0,d.useState)(utils_deepCopy(t.startTime)),[s,a]=(0,d.useState)(t.premiumInfo.allEggs),{hasAdBoost:o,toggleAdBoost:u}=useAdBoost({gameState:t});return{onSubmit:function(e){e.preventDefault(),n(function(){let e=convertTimeRemainingToMinutes(h);return{startTime:i,timeEntered:new Date,timeRemaining:e,premiumInfo:{adBoost:o,allEggs:s},stockpiles:y,levels:v}}()),l()},setAllEggs:function(e){let{value:t}=calcLevelKeyValue(e);a(t)},hasAdBoost:o,toggleAdBoost:u,startTime:i,setStartTime:r}}({gameState:t,setGameState:n,closeModal:l});return(0,a.jsxs)("form",{onSubmit:e=>r(e),children:[(0,a.jsx)(InputPageWrapper,{isVisible:!0,children:(0,a.jsxs)("div",{className:"flex flex-col gap-6 ".concat(i?"mt-3":"mt-5"),children:[(0,a.jsx)(StartTime,{startTime:c,setStartTime:p}),(0,a.jsx)(AllEggs,{gameState:t,handleLevelChange:s}),(0,a.jsx)(AdBoost,{hasAdBoost:o,toggleAdBoost:u})]})}),(0,a.jsx)(ModalSubmitButton,{label:"submit",disabled:!1})]})}function StartTime(e){let{startTime:t,setStartTime:n}=e,{handleHourChange:l,handleMinuteChange:i}=function(e){let{startTime:t,setStartTime:n}=e;return{handleHourChange:function(e){let l=utils_deepCopy(t);l.setHours(parseInt(e.target.value)),n(l)},handleMinuteChange:function(e){let l=structuredClone(t);l.setMinutes(parseInt(e.target.value)),n(l)}}}({startTime:t,setStartTime:n});return(0,a.jsxs)("fieldset",{className:"flex items-center",children:[(0,a.jsx)("span",{children:(0,a.jsx)(Label,{htmlFor:"",tagName:"legend",children:"Starting At"})}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(SelectHours,{id:"id_planStartHour",initValue:t.getHours().toString(),handleChange:l}),(0,a.jsx)(SelectMinutes,{id:"id_planStartMinute",initValue:t.getMinutes().toString(),handleChange:i})]})]})}function ChangeModeButton(e){let{changeMode:t}=e;return(0,a.jsx)("button",{type:"button",onClick:t,className:"absolute [top:calc(2.5rem+1px)] right-1 w-max px-1 pb-0.5 text-xs hover:bg-violet-100 text-violet-500 rounded-b",children:"change mode"})}function StatusForm(e){let{setGameState:t,gameState:n,modeKit:l,closeModal:i}=e,[s,o]=(0,d.useState)(!1),[u,c]=(0,d.useState)(l.mode!==r.active&&l.mode!==r.plan);return(0,a.jsxs)(Modal,{heading:"".concat(l.mode!==r.active||s?l.mode!==r.plan||s?"":"Plan ":"Active ","Game Status"),closeModal:i,children:[u||s?null:(0,a.jsx)(ChangeModeButton,{changeMode:()=>o(!0)}),l.mode!==r.active||s?l.mode!==r.plan||s?(0,a.jsx)(FormSetMode,{mode:l.mode,setMode:l.setMode,close:()=>o(!1)}):(0,a.jsx)(FormPlanMode,{gameState:n,setGameState:t,closeModal:i,isInitialisingMode:u}):(0,a.jsx)(FormActiveMode,{gameState:n,setGameState:t,closeModal:i,changeMode:()=>o(!0),wantBackToMode:u})]})}function InputPageWrapper(e){let{isVisible:t,heading:n,children:l}=e;return(0,a.jsx)("section",{className:t?"":"sr-only",children:(0,a.jsxs)(ModalFieldsWrapper,{children:[void 0===n?null:(0,a.jsx)("h3",{className:"pl-0.5 font-semibold text-black mb-3",children:n}),l]})})}function LevelsWrapper(e){let{children:t}=e;return(0,a.jsx)("div",{className:"pl-2 flex flex-col gap-5",children:t})}function Label(e){let{htmlFor:t,tagName:n,extraCSS:l,children:i}=e,r=null!=n?n:"label";return l=null!=l?l:"font-semibold",(0,a.jsx)(r,{className:"block w-20 ml-2 "+l,htmlFor:t,children:i})}function UnitLevelInput(e){let{keyName:t,idStr:n,labelStr:l,initValue:i,options:r,handleLevelChange:s,currentValue:o}=e,u=f[t];return(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(SelectWithLabel,{selectExtraCSS:"w-16",labelExtraCSS:"block w-16",id:n,labelDisplay:l,initValue:i,options:r,handleChange:s}),(0,a.jsx)("div",{className:"ml-2 flex gap-1",children:o===u.upgrades.length?(0,a.jsx)(BadgeMaxed,{extraCSS:"opacity-40"}):u.upgrades[o].costs.map((e,t)=>(0,a.jsx)(BadgeCost,{data:e,extraCSS:void 0},t))})]})}function InputNumberAsText(e){let{idStr:t,value:n,handleChange:l,cssStr:i}=e,r="string"==typeof n?n:"number"!=typeof n||isNaN(n)||void 0===n?"0":n.toString();return void 0!==i&&i.includes("border")||(i+=" border-neutral-300 "),(0,a.jsx)("input",{className:"border rounded-sm "+i,type:"text",inputMode:"numeric",pattern:"^[0-9]+$|^$",id:t,value:r,onChange:e=>l(e)})}function getInitValueForLevelSelect(e,t){let n;let l=e.toLowerCase();return null!==t&&(n=formatSelectValueStr(e,t.levels[l])),n}function getUpgradeOptions(e){let{name:t,max:n}=e,l=[];for(let e=0;e<=n;e++){let n={valueStr:formatSelectValueStr(t,e),displayStr:"".concat(e)};l.push(n)}return l}function OfflineForm(e){let{closeForm:t,offlinePeriod:n,gameState:l,setOfflinePeriods:i,idxToEdit:r,offlinePeriods:s}=e,o=(0,d.useRef)(null);o.current=s;let u=null===n,{formOfflinePeriod:c,handleSubmit:p,handleSingleKeyChange:g,removeOfflinePeriod:m,errorMessage:f,showError:x}=function(e){let{offlinePeriod:t,idxToEdit:n,setOfflinePeriods:l,closeForm:i,refOfflinePeriods:r}=e,[s,a]=(0,d.useState)(setupOtherOfflinePeriodTimes()),[o,u]=(0,d.useState)(!1),[c,p]=(0,d.useState)(""),g=null===t?function(){let e=calcIsValid(j,T);return{start:j,end:T,isValid:void 0===e?{start:!0,end:!0}:e,id:generateKey("".concat(printOfflineTime(j),"_").concat(printOfflineTime(T)))}}():function(e){let t={start:fixOfflineTimeStrings(e.start),end:fixOfflineTimeStrings(e.end)},n=calcIsValid(t.start,t.end);return{...t,isValid:void 0===n?{start:!0,end:!0}:n,id:generateKey("".concat(printOfflineTime(e.start),"_").concat(printOfflineTime(e.end)))}}(t),[m,f]=(0,d.useState)(g);function setupOtherOfflinePeriodTimes(){if(null===r.current)return[];let e=[],n=null===t?-1:convertOfflineTimeToNumber(t.start),l=null===t?-1:convertOfflineTimeToNumber(t.end);for(let t=0;t<r.current.length;t++){let i=convertOfflineTimeToNumber(r.current[t].start),s=convertOfflineTimeToNumber(r.current[t].end);n!==i&&l!==s&&e.push({start:i,end:s})}return e}function generateKey(e){return"".concat(e,"_").concat(new Date().getTime())}function calcIsValid(e,t){let n=convertOfflineTimeToNumber(e),l=convertOfflineTimeToNumber(t),i=runChecklist(n,l);for(let e=0;e<i.length;e++)if(void 0!==i[e].isValid)return i[e].isValid;return{start:!0,end:!0}}function runChecklist(e,t){return[null!==r.current&&r.current.length>150?{result:!1,message:"You have entered the maximum number of offline periods",isValid:{start:!1,end:!1}}:{result:!0},e>t?{result:!1,message:"Invalid input: offline period ends before it begins",isValid:{start:!1,end:!1}}:{result:!0},t-e<1?{result:!1,message:"Invalid input: offline period must last for at least one minute",isValid:{start:!1,end:!1}}:{result:!0},performCheckAgainstExistingOfflinePeriods((n,l)=>e===n&&t===l)?{result:!1,message:"Invalid input: this time range already exists",isValid:{start:!1,end:!1}}:{result:!0},performCheckAgainstExistingOfflinePeriods((n,l)=>e<n&&t>l)?{result:!1,message:"Invalid input: this time range is partially covered by an existing offline period",isValid:{start:!1,end:!1}}:{result:!0},function(e,t){let n=performCheckAgainstExistingOfflinePeriods((t,n)=>e>=t&&e<=n),l=performCheckAgainstExistingOfflinePeriods((e,n)=>t>=e&&t<=n);return n||l?{result:!1,message:n&&!l?"Invalid input: start of offline period overlaps an existing offline period":!n&&l?"Invalid input: end of offline period overlaps an existing offline period":n&&l?"Invalid input: this time range is entirely covered by an existing offline period":"",isValid:{start:!n,end:!l}}:{result:!0}}(e,t),function(e,t){let n=s.map(e=>e.end-e.start),l=n.reduce((e,t)=>e+=t,0);return t-e+l>4320?{result:!1,message:"Invalid input: this time range would make offline periods cover the entire event",isValid:{start:!1,end:!1}}:{result:!0}}(e,t)]}function performCheckAgainstExistingOfflinePeriods(e){for(let t=0;t<s.length;t++)if(e(s[t].start,s[t].end))return!0;return!1}return(0,d.useEffect)(()=>{a(setupOtherOfflinePeriodTimes())},[r.current]),{formOfflinePeriod:m,handleSubmit:function(e){if(e.preventDefault(),function(){let e=convertOfflineTimeToNumber(m.start),t=convertOfflineTimeToNumber(m.end),n=runChecklist(e,t);for(let e=0;e<n.length;e++)if(!1===n[e].result)return void 0!==n[e].message&&(p(n[e].message),u(!0)),void 0!==n[e].isValid&&f(t=>{var l,i;return{...t,isValid:{start:null===(l=n[e].isValid)||void 0===l?void 0:l.start,end:null===(i=n[e].isValid)||void 0===i?void 0:i.end}}}),!1;return!0}()){let e=utils_deepCopy(m);delete e.id,delete e.isValid,function(e){if(null===n)l(t=>[...t,e]),i();else{let t=utils_deepCopy(r.current);t[n]=e,l(t),i()}}(e),i()}},removeOfflinePeriod:function(){if(null===n){i();return}let e=utils_deepCopy(r.current);l(e.slice(0,n).concat(e.slice(n+1))),i()},showError:o,errorMessage:c,handleSingleKeyChange:function(e,t,n){let l=utils_deepCopy(m);l[e][t]=n,o&&l.isValid&&u(!1),f(l)}}}({offlinePeriod:n,idxToEdit:r,setOfflinePeriods:i,closeForm:t,refOfflinePeriods:o}),h=(0,d.useId)(),y={isInvalid:x,errorMessageId:"offlinePeriodsError"};return(0,a.jsx)(Modal,{heading:null===n?"New Offline Period":"Edit Offline Period",closeModal:t,children:(0,a.jsxs)("form",{onSubmit:e=>p(e),children:[(0,a.jsx)(ModalFieldsWrapper,{children:(0,a.jsxs)("fieldset",{"aria-invalid":y.isInvalid,"aria-errormessage":y.errorMessageId,children:[(0,a.jsxs)(ModalLegend,{children:[null===n?"Set":"Update"," time range",null===n?null:(0,a.jsxs)("span",{className:"block font-normal text-neutral-600 text-xs",children:["Period ",calcDateWithTimeDisplayStr(convertOfflineTimeToDate(n.start,l.startTime)),"\xa0to\xa0",calcDateWithTimeDisplayStr(convertOfflineTimeToDate(n.end,l.startTime))]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-5 items-center",children:[(0,a.jsx)(OfflineTimeInput,{legend:"from",idStr:h,roleKey:"start",dhm:c.start,handleSingleKeyChange:g,gameState:l,showError:x&&(!c.isValid.start||!c.isValid.end)}),(0,a.jsx)(OfflineTimeInput,{legend:"to",idStr:h,roleKey:"end",dhm:c.end,handleSingleKeyChange:g,gameState:l,showError:x&&(!c.isValid.start||!c.isValid.end)}),!x||c.isValid.start&&c.isValid.end?null:(0,a.jsx)(ErrorMessage,{idStr:y.errorMessageId,message:f})]})]})}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(Button,{size:"twin",colours:"primary",disabled:x&&!c.isValid,extraCSS:u?"border-2":void 0,children:u?"add":"update"}),u?null:(0,a.jsx)(Button,{size:"twin",colours:"warning",htmlType:"button",onClick:()=>m(),children:"delete"})]})]})})}function ErrorMessage(e){let{idStr:t,message:n}=e;return(0,a.jsx)("p",{id:t,className:"text-sm border-l-4 border-red-500 bg-red-200 bg-opacity-30 text-black px-3 py-2","aria-live":"polite",children:n})}function OfflineTimeInput(e){let{legend:t,idStr:n,roleKey:l,dhm:i,handleSingleKeyChange:r,gameState:s,showError:o}=e,u=n+"-"+l+"-d",d=n+"-"+l+"-h",c=n+"-"+l+"-m",{selectedDateAsIndex:p,validDates:g,convertValidDatesToOptions:m}=function(e){let{gameState:t}=e,n=function(){let e=new Date(t.startTime.getTime()+2592e5),n=[],l=new Date(t.startTime.getTime());for(;l.getTime()<=e.getTime();)n.push({date:l.getDate(),month:l.getMonth()}),l.setDate(l.getDate()+1);return n}();return{selectedDateAsIndex:function(e){return n.findIndex(t=>t.date===parseInt(e.target.value))},validDates:n,convertValidDatesToOptions:function(e){return e.map(e=>({valueStr:e.date.toString(),displayStr:"".concat(e.date," ").concat(calcMonthName(e.month))}))}}}({gameState:s});return(0,a.jsxs)(FieldsetWrapper,{children:[(0,a.jsx)("legend",{className:"font-semibold ml-2 mb-1 px-1",children:t}),(0,a.jsxs)("div",{className:"flex flex-nowrap text-sm items-center",children:[(0,a.jsx)(SelectWithSRLabel,{id:u,selectExtraCSS:void 0,handleChange:function(e){let t=p(e);-1!==t&&r(l,"dateOffset",t)},initValue:g[i.dateOffset].date.toString(),options:m(g),visualLabel:"",srLabel:"date",extraCSS:"pl-2 pr-1"}),(0,a.jsx)(SelectHours,{id:d,handleChange:e=>r(l,"hours",parseInt(e.target.value)),initValue:i.hours.toString()}),(0,a.jsx)(SelectMinutes,{id:c,handleChange:e=>r(l,"minutes",parseInt(e.target.value)),initValue:i.minutes.toString()}),o?(0,a.jsx)("span",{className:"ml-3 text-red-500 font-bold text-xl",children:"X"}):null]})]})}function VisualToggle(e){let{onChange:t,idStr:n,name:l,value:i,toggledOn:r,displayText:s}=e;return(0,a.jsx)("form",{className:"md:hidden",children:(0,a.jsxs)("label",{className:"flex flex-col items-center gap-0.5",children:[(0,a.jsx)("input",{checked:r,type:"checkbox",disabled:!1,id:n,name:l,value:i,onChange:t,className:"sr-only"}),(0,a.jsx)("span",{className:"block text-xs text-black font-medium",children:s}),(0,a.jsxs)("div",{className:"relative h-6 w-[3.25rem] px-1 rounded-full ".concat(r?"bg-violet-600 hover:bg-violet-500":"bg-neutral-400 hover:bg-neutral-500"),children:[r?(0,a.jsxs)("div",{className:"absolute left-1.5 top-[calc(0.25rem_-_1px)]",children:[(0,a.jsx)(IconEyeOpen,{size:"18px",colour:r?"white":"transparent"}),(0,a.jsx)("p",{className:"sr-only",children:"shown"})]}):(0,a.jsxs)("div",{className:"absolute right-1.5 top-1",children:[(0,a.jsx)(IconEyeClosed,{size:"18px",colour:r?"transparent":"white"}),(0,a.jsx)("p",{className:"sr-only",children:"hidden"})]}),(0,a.jsx)("div",{className:"absolute top-1 h-4 w-4 bg-white rounded-full ease-in duration-200 ".concat(r?"translate-x-[1.75rem]":"")})]})]})})}function StickyBar(e){let{saveLoadToggles:t,viewToggles:n}=e;return(0,a.jsx)("div",{className:"".concat(p.mainAsBg," ").concat(p.mainAsBorder," border-b px-3 md:pr-0 pt-1 pb-2 w-full flex flex-col sticky top-0 relative z-40 md:[top:calc(4.5rem)] md:[grid-area:buttons]"),children:(0,a.jsx)(HeaderButtonsContainer,{viewToggles:n,saveLoadToggles:t})})}function HeaderButtonsContainer(e){let{viewToggles:t,saveLoadToggles:n}=e;return(0,a.jsxs)("div",{className:"flex justify-between items-end",children:[(0,a.jsx)("div",{className:"flex gap-2",children:t.map(e=>(0,a.jsx)(VisualToggle,{onChange:e.toggle,toggledOn:e.value,displayText:e.displayStr,idStr:"id_vis".concat(e.displayStr),name:"vis".concat(e.displayStr),value:"vis".concat(e.displayStr)},"rkVis_".concat(e.displayStr)))}),(0,a.jsx)("div",{className:"flex gap-2",children:n.map(e=>(0,a.jsx)(Button,{size:"stickyBar",colours:p.secondaryOnToolbar,onClick:e.toggle,children:e.data.displayStr},e.data.displayStr))})]})}function SectionGameState(e){let{gameState:t,openEditForm:n,mode:l}=e;return(0,a.jsxs)("div",{className:"px-2",children:[(0,a.jsx)(TimeAndPremiumStatus,{gameState:t,mode:l}),l===r.active?(0,a.jsxs)("div",{className:"flex flex-col items-start",children:[(0,a.jsx)(StockpilesStatus,{stockpiles:t.stockpiles}),(0,a.jsx)(UpgradeLevels,{levels:t.levels})]}):null,(0,a.jsx)(EditButtonBox,{openEditForm:n,label:void 0})]})}function TimeAndPremiumStatus(e){let{gameState:t,mode:n}=e,l=convertTimeIDToTimeRemaining(t.timeRemaining);return(0,a.jsxs)("dl",{className:"grid [max-width:320px] grid-cols-[6.5rem_1fr_1fr] gap-1",children:[n===r.active?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(GridRowWrapper,{title:"Updated",children:(0,a.jsx)("dd",{suppressHydrationWarning:!0,children:calcDateWithTimeDisplayStr(t.timeEntered)})}),(0,a.jsx)(GridRowWrapper,{title:"Remaining",children:(0,a.jsx)("dd",{children:null===l?"":"".concat(l.days,"d ").concat(l.hours,"h ").concat(l.minutes,"m")})})]}):null,n===r.plan?(0,a.jsx)(GridRowWrapper,{title:"Start Time",children:(0,a.jsx)("dd",{children:calcDateWithTimeDisplayStr(t.startTime)})}):null,(0,a.jsx)(GridRowWrapper,{title:"All".concat(nbsp(),"Eggs"),children:(0,a.jsxs)("dd",{children:["+",t.premiumInfo.allEggs]})}),(0,a.jsx)(GridRowWrapper,{title:"Ad".concat(nbsp(),"Boost"),children:(0,a.jsx)("div",{children:t.premiumInfo.adBoost?(0,a.jsxs)("dd",{className:"text-green-600",children:["✔",(0,a.jsx)("span",{className:"sr-only",children:"yes"})]}):(0,a.jsxs)("dd",{className:"text-red-700",children:["❌",(0,a.jsx)("span",{className:"sr-only",children:"no"})]})})})]})}function GridRowWrapper(e){let{title:t,children:n}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("dt",{className:"col-start-1 font-medium",children:t}),n]})}function StockpilesStatus(e){let{stockpiles:t}=e;return(0,a.jsxs)("div",{className:"mt-3 w-full",children:[(0,a.jsxs)("dl",{className:"grid [max-width:320px] grid-cols-[6rem_1fr_4rem] px-2 py-1 mb-1 border-l-4 font-bold ".concat(m.dust.field),children:[(0,a.jsx)("dt",{children:"Dust"}),(0,a.jsx)("dd",{children:t.dust.toLocaleString()}),(0,a.jsxs)("dd",{className:"justify-self-end",children:["(",toBillions(t.dust),")"]})]}),(0,a.jsx)(StockpilesDisplay,{stockpiles:t,extraCSS:"gap-1"})]})}function UpgradeLevels(e){let{levels:t}=e,n=calcFilteredLevelsData("Worker",t),l=calcFilteredLevelsData("Egg",t),i=calcFilteredLevelsData("Buff",t);return(0,a.jsxs)("div",{className:"mt-3 w-full",children:[(0,a.jsx)("p",{className:"sr-only",children:"Upgrade Levels"}),(0,a.jsxs)("div",{className:"grid max-w-xs w-full justify-between grid-cols-[repeat(8,2rem)] grid-rows-[auto_auto]",children:[n.map(e=>(0,a.jsx)(LevelWithLabel,{label:e.displayStr,level:e.level,max:e.max},e.key)),l.map(e=>(0,a.jsx)(LevelWithLabel,{label:e.displayStr,level:e.level,max:e.max},e.key)),i.map((e,t)=>(0,a.jsx)(LevelWithLabel,{label:e.displayStr,level:e.level,max:e.max,gridPosCSS:0===t?"col-start-7":1===t?"col-start-8":""},e.key))]})]})}function LevelWithLabel(e){let{label:t,level:n,max:l,gridPosCSS:i}=e;return void 0===i&&(i=""),(0,a.jsxs)("div",{className:"flex flex-col items-center ".concat(i),children:[(0,a.jsx)("dt",{className:"px-2 pb-0.25 text-sm font-normal",children:t}),(0,a.jsx)(Level,{level:n,max:l,extraCSS:"mx-0.5"})]})}function Level(e){let{level:t,max:n,extraCSS:l}=e;return(0,a.jsx)("dd",{className:"block w-6 py-1 rounded-lg border font-bold text-center text-xs ".concat(void 0===n||t<n?"border-gray-200 bg-gray-100 text-gray-900":c," ").concat(l),children:t})}function calcFilteredLevelsData(e,t){let n="Egg"===e?e=>e.charAt(0):e=>capitalise(e.slice(0,2));return Object.keys(t).filter(t=>{let n=f[t];return n.type===e}).map(e=>({key:e,displayStr:n(e),level:t[e],max:getUpgradesDataFromJSON(e).length}))}function SectionOfflinePeriods(e){let{offlinePeriods:t,openModal:n,gameState:l,idxEdit:i}=e;return null===l?null:(0,a.jsxs)("div",{className:"px-2",children:[(0,a.jsx)(OfflineDisplay,{offlinePeriods:t,gameState:l,openForm:n,idxEdit:i}),(0,a.jsx)(EditButtonBox,{openEditForm:()=>n(null),label:"add"})]})}function OfflineDisplay(e){let{offlinePeriods:t,gameState:n,openForm:l,idxEdit:i}=e,r=function(e){if(void 0===e||0===e.length)return e;let t=[[],[],[],[]];for(let n=0;n<e.length;n++){let l=e[n];t[l.start.dateOffset].push({...l,index:n})}return t}(t),s=void 0===r||0===r.length;return(0,a.jsx)("div",{className:"overflow-y-auto overflow-x-hidden max-h-[calc(100vh-20rem)] plnMd:max-h-[17rem]",children:s?(0,a.jsx)("p",{children:"None entered"}):r.map((e,t)=>(0,a.jsx)(DayGroup,{displayOfflinePeriods:e,gameState:n,openForm:l,idxEdit:i,dayGroupID:t},"offlinePeriodsDayGroup".concat(t)))})}function DayGroup(e){let{displayOfflinePeriods:t,gameState:n,openForm:l,idxEdit:i,dayGroupID:r}=e,s=0===t.length?convertOfflineTimeToDate({dateOffset:r,hours:0,minutes:0},n.startTime):convertOfflineTimeToDate(t[0].start,n.startTime);return(0,a.jsxs)("section",{children:[(0,a.jsx)("h3",{className:"font-semibold text-violet-700",children:calcDateDisplayStr(s)}),(0,a.jsx)("div",{className:"pl-12 pr-2",children:0===t.length?(0,a.jsx)("p",{className:"mb-2",children:"None entered"}):(0,a.jsx)("ol",{children:t.map(e=>(0,a.jsx)(OfflinePeriod,{offlinePeriod:e,gameState:n,isBeingEdited:i===e.index,openForm:()=>l(e.index)},"offlinePeriod".concat(printOfflineTime(e.start))))})})]})}function OfflinePeriod(e){let{offlinePeriod:t,gameState:n,isBeingEdited:l,openForm:i}=e,r="";l&&(r="text-gray-300");let s=convertOfflineTimeToDate(t.start,n.startTime),o=convertOfflineTimeToDate(t.end,n.startTime);return(0,a.jsxs)("li",{className:"grid [grid-template-columns:1fr_auto] grid-rows-1 items-center mb-2 ".concat(r),children:[(0,a.jsxs)("div",{children:[calcTimeDisplayStr(s)," - ",s.getDate()===o.getDate()?calcTimeDisplayStr(o):calcDateWithTimeDisplayStr(o)]}),(0,a.jsx)(Button,{size:"inline",colours:"secondary",onClick:i,disabled:l,children:"edit"})]},"".concat(printOfflineTime(t.start),"_").concat(printOfflineTime(t.end)))}function DisplayUserInput(e){let{gameState:t,openGameStateModal:n,mode:l,offlinePeriods:i,openOfflinePeriodsModal:r,offlinePeriodIdxEdit:s,showGameState:o,showOfflinePeriods:u}=e,d=calcVisibilityCSS(o),c=calcVisibilityCSS(u),m=o||u?"py-3 gap-2 border-b ".concat(p.borderOnMain," shadow-md"):"";function calcVisibilityCSS(e){return e?"":" sr-only"}return(0,a.jsx)("div",{className:"sticky h-0 ".concat(g," relative z-20 md:sticky md:[grid-area:status] md:[top:calc(7.5rem_+_1px)]"),children:(0,a.jsxs)("div",{className:"".concat(p.mainAsBg," w-full flex flex-col items-center md:bg-transparent md:border-none md:shadow-none md:min-w-[20rem] md:[height:calc(100vh-8rem)] md:gap-3 md:px-3 md:pt-0 md:pb-1.5 ").concat(m),children:[(0,a.jsx)(DisplayInputSection,{title:"Game Status",extraCSS:"md:mt-0 ".concat(d),children:(0,a.jsx)(SectionGameState,{gameState:t,openEditForm:n,mode:l})}),(0,a.jsx)(DisplayInputSection,{title:"Offline Periods",extraCSS:"md:max-h-[calc(100vh-33rem)] ".concat(c),children:(0,a.jsx)(SectionOfflinePeriods,{offlinePeriods:i,gameState:t,openModal:r,idxEdit:s})})]})})}function DisplayInputSection(e){let{title:t,extraCSS:n,children:l}=e;return(0,a.jsxs)("section",{className:"mt-1 mb-1 w-full max-w-xs text-sm ".concat(p.panelBg," shadow-lg rounded ").concat("overflow-y-auto overflow-x-hidden max-h-[calc(100vh-10rem)] flex-shrink-0"," ").concat(n),children:[(0,a.jsx)("h2",{className:"".concat(p.headingBgAndText," rounded-t py-1.5"),children:(0,a.jsx)(HeaderFooterContentWrapper,{borderColour:"border-neutral-400",margins:"ml-2",padding:"pl-2",children:(0,a.jsx)("span",{className:"text-lg font-bold mb-2",children:t})})}),(0,a.jsx)("div",{className:"px-2 pt-4 pb-3",children:l})]})}function EditButtonBox(e){let{openEditForm:t,label:n}=e;return(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(Button,{size:"default",colours:"primary",onClick:()=>t(),children:null!=n?n:"edit"})})}function ErrorWithPlanner(){return(0,a.jsxs)(NoPlannerWrapper,{mode:"error",children:[(0,a.jsx)(NoPlannerHeading,{children:"Error"}),(0,a.jsx)("p",{children:"The planner isn't working right now."}),(0,a.jsx)("h3",{className:"text-base font-semibold mt-6 mb-1",children:"Some types of errors can be fixed by:"}),(0,a.jsxs)("ul",{className:"list-disc ml-8",children:[(0,a.jsx)("li",{children:"Re-entering game status"}),(0,a.jsx)("li",{children:"Deleting all offline periods and re-entering"}),(0,a.jsxs)("li",{children:["Starting again by refreshing the page (on Windows, try the ",(0,a.jsx)("kbd",{className:"bg-neutral-100 rounded px-0.5",children:"F5"})," key)"]})]}),(0,a.jsx)("p",{className:"mt-6",children:"If you've tried those steps and you're still seeing this message, it's a techie problem at our end. Sorry! Please try again later."})]})}function Home(){let{gameState:e,setGameState:t,offlinePeriods:n,setOfflinePeriods:l,actions:i,setActions:r,prodSettingsNow:s,setProdSettingsNow:o,purchaseData:u,switchData:c,timeIDGroups:g,prodSettingsBeforeNow:m,reset:f,loadedFromAutosave:x}=function(){let e,t,n;let l={gameState:S,offlinePeriods:[],actions:(e=["bronte","anne","petra","manny","tony","ruth"],t=[],n=[],getMainKeysFromJSON().forEach(l=>{let i=getUpgradesDataFromJSON(l);for(let r=0;r<i.length;r++)if(!("trinity"===l&&r<3)){let i={type:"upgrade",key:l,level:r+1};0===r&&e.includes(l)?t.push(i):n.push(i)}}),[{type:"upgrade",key:"trinity",level:1},{type:"upgrade",key:"trinity",level:2},{type:"upgrade",key:"trinity",level:3}].concat(t).concat(n)),prodSettingsNow:null},[i,r]=(0,d.useState)(l.gameState),[s,a]=(0,d.useState)(l.offlinePeriods),[o,u]=(0,d.useState)(l.actions),[c,p]=(0,d.useState)(l.prodSettingsNow),g=calcPlanData({gameState:i,actions:o,offlinePeriods:s,prodSettingsNow:c}),[m,f]=(0,d.useState)(null==g?void 0:g.purchaseData),[x,h]=(0,d.useState)(null==g?void 0:g.switchData),[y,b]=(0,d.useState)(null==g?void 0:g.productionSettingsBeforeNow),[v,j]=(0,d.useState)(null==g?void 0:g.timeData),[T,w]=(0,d.useState)(null),{autosave:N,deleteAutosave:D,autoload:C}=function(){let e="autoSaveData";return{autosave:function(t){localStorage.setItem(e,JSON.stringify(t))},deleteAutosave:function(){localStorage.removeItem(e)},autoload:function(){let t=localStorage.getItem(e);if(null===t)return null;let n=JSON.parse(t);return n.gameState.startTime=new Date(n.gameState.startTime),n.gameState.timeEntered=new Date(n.gameState.startTime),void 0===n.offlinePeriods&&(n.offlinePeriods=[]),n}}}();(0,d.useEffect)(()=>{let e=C();null!==e?(r(e.gameState),a(e.offlinePeriods),u(e.actions),p(e.prodSettingsNow),w(!0)):w(!1)},[]),(0,d.useEffect)(()=>{let e=calcPlanData({gameState:i,actions:o,offlinePeriods:s,prodSettingsNow:c});null!==e&&(f(e.purchaseData),h(e.switchData),b(e.productionSettingsBeforeNow),j(e.timeData))},[c,o,i,s]);let k=void 0===m||void 0===x||void 0===v?null:function(e){let{purchaseData:t,switchData:n,timeData:l}=e;if(null===t)return[];let i=[],r=0;for(let e=0;e<t.length;e++){let s=t[e],a=e===t.length-1?null:t[e+1];if(null===a||a.purchaseTimeID!==s.purchaseTimeID){let o=null!==a&&a.purchaseTimeID!==s.purchaseTimeID?e+1:null,u=function(e){let{timeID:i,endIndex:s}=e,a=null===s?t.slice(r):t.slice(r,s),o=i.toString() in n?n[i.toString()]:[],u=i.toString(),d=utils_deepCopy(l[u]);return{timeID:i,...d,startPos:r+1,upgrades:a,switches:Array.from(new Set(o))}}({timeID:s.purchaseTimeID,endIndex:o});i.push(u),r=e+1}}return i}({purchaseData:m,switchData:x,timeData:v});return{gameState:i,setGameState:function(e){r(e),N({gameState:e,offlinePeriods:s,actions:o,prodSettingsNow:c})},offlinePeriods:s,setOfflinePeriods:function(e){a(e),N({gameState:i,offlinePeriods:e,actions:o,prodSettingsNow:c})},actions:o,setActions:function(e){u(e),N({gameState:i,offlinePeriods:s,actions:e,prodSettingsNow:c})},prodSettingsNow:c,setProdSettingsNow:function(e){p(e),N({gameState:i,offlinePeriods:s,actions:o,prodSettingsNow:e})},purchaseData:m,switchData:x,timeIDGroups:k,prodSettingsBeforeNow:y,reset:function(){r(l.gameState),a(l.offlinePeriods),u(l.actions),p(l.prodSettingsNow),D()},loadedFromAutosave:T}}(),{showGameState:h,showOfflinePeriods:y,displayInputToggles:b}=function(){let[e,t]=(0,d.useState)(!1),[n,l]=(0,d.useState)(!1);(0,d.useEffect)(()=>{t(window.innerWidth>=768),l(window.innerWidth>=768)},[]),function(e,t,n,l){let[i,r]=(0,d.useState)(!1);function calcIsDesktopWidth(){return window.innerWidth>=768}function handleResize(){r(calcIsDesktopWidth())}(0,d.useLayoutEffect)(()=>{r(calcIsDesktopWidth())},[]),(0,d.useEffect)(()=>(window.addEventListener("resize",handleResize),()=>window.removeEventListener("resize",handleResize)),[]),(0,d.useEffect)(()=>{i&&!e&&t(!0),i&&!n&&l(!0)},[e,t,n,l,i])}(e,t,n,l);let i=[{displayStr:"game",toggle:()=>t(e=>!e),value:e},{displayStr:"offline",toggle:()=>l(e=>!e),value:n}];return{showGameState:e,showOfflinePeriods:n,displayInputToggles:i}}(),v=function(e){let{gameState:t,setGameState:n}=e,[l,i]=(0,d.useState)(!1);return{isVisible:l,openModal:()=>i(!0),closeModal:()=>i(!1),action:n,data:{gameState:t,mode:function(){let e="lastUsedMode",[t,n]=(0,d.useState)(null);function updateMode(t){n(t),localStorage.setItem(e,JSON.stringify(t))}return(0,d.useEffect)(()=>{n(function(){let t=localStorage.getItem(e);if(null===t)return null;let n=JSON.parse(t);return n}())},[]),{mode:t,setMode:updateMode,reset:function(){updateMode(null)}}}()}}}({gameState:e,setGameState:t}),j=function(e){let{offlinePeriods:t,setOfflinePeriods:n,gameState:l}=e,[i,r]=(0,d.useState)(!1),[s,a]=(0,d.useState)(null);return{isVisible:i,openModal:function(e){a(null===e||e>=0&&e<t.length?e:null),r(!0)},closeModal:function(){r(!1),a(null)},action:n,data:{idxToEdit:s,offlinePeriods:t,gameState:l,displayStr:"offline",offlinePeriod:null===s?null:t[s]}}}({offlinePeriods:n,setOfflinePeriods:l,gameState:e}),{save:T,load:w}=function(e){let{actions:t,setActions:n,offlinePeriods:l,setOfflinePeriods:i,gameState:r,setGameState:s,reset:a}=e,[o,u]=(0,d.useState)(!1),[c,p]=(0,d.useState)(!1),g="saveFile_";function convertToKeyName(e){return"".concat(g).concat(e)}return{save:{isVisible:o,closeModal:()=>u(!1),toggle:()=>u(e=>!e),action:function(e){let n={actions:t,offlinePeriods:l,premiumInfo:r.premiumInfo};localStorage.setItem(convertToKeyName(e),JSON.stringify(n))},data:{displayStr:"save",convertToKeyName}},load:{isVisible:c,closeModal:()=>p(!1),toggle:()=>p(e=>!e),action:function(e){let t=localStorage.getItem(convertToKeyName(e));if(null===t)return;let l=JSON.parse(t);"actions"in l&&0!==l.actions.length&&n(l.actions),"offlinePeriods"in l&&0!==l.offlinePeriods.length&&i("date"in l.offlinePeriods[0].start?l.offlinePeriods.map(e=>{let t=Object.assign(e.start,{dateOffset:e.start.date});delete t.date;let n=Object.assign(e.end,{dateOffset:e.end.date});return delete n.date,{start:t,end:n}}):l.offlinePeriods),"premiumInfo"in l&&s({...r,premiumInfo:l.premiumInfo})},data:{displayStr:"load",loadOptions:function(){let e=Object.keys(localStorage).filter(e=>e.startsWith(g)).map(e=>{let t=e.replace(g,"");return{displayStr:t,valueStr:t}});return 0===e.length?null:e},reset:a}}}}({actions:i,setActions:r,offlinePeriods:n,setOfflinePeriods:l,gameState:e,setGameState:t,reset:f}),[N,D]=(0,d.useState)(!1);return N||null===x||(x||v.openModal(),D(!0)),(0,a.jsxs)("main",{className:"".concat(p.emptyBg," flex justify-center min-h-screen"),children:[(0,a.jsx)(page_Modals,{modals:{save:T,load:w,gameState:v,offlinePeriods:j}}),(0,a.jsxs)("div",{className:"".concat(p.mainAsBg,' relative z-20 w-full max-w-5xl md:pr-3 md:grid md:grid-rows-[auto_auto_auto] md:grid-cols-[auto_1fr] md:[grid-template-areas:"heading_heading""buttons_buttons""status_."]'),children:[(0,a.jsx)(MainPageHeading,{}),(0,a.jsx)(StickyBar,{saveLoadToggles:[T,w],viewToggles:b}),(0,a.jsx)(DisplayUserInput,{showGameState:h,gameState:e,openGameStateModal:v.openModal,mode:v.data.mode.mode,showOfflinePeriods:y,offlinePeriods:n,openOfflinePeriodsModal:j.openModal,offlinePeriodIdxEdit:j.data.idxToEdit}),(0,a.jsx)("div",{className:"".concat(p.mainAsBg," [min-height:calc(100vh-4.5rem-1px-3rem)]"),children:null===e||void 0===u||void 0===c||null===g||void 0===m?(0,a.jsx)(ErrorWithPlanner,{}):(0,a.jsx)(Planner,{gameState:e,actions:i,setActions:r,purchaseData:u,timeIDGroups:g,prodSettingsNow:s,setProdSettingsNow:o,prodSettingsBeforeNow:m})})]})]})}function MainPageHeading(){return(0,a.jsxs)("h1",{className:"".concat(p.mainAsBg," ").concat(p.mainHeadingText," [height:4.5rem] relative z-10 flex gap-2 px-3 pt-1 pb-3 block md:sticky md:top-0 md:relative md:[grid-area:heading]"),children:[(0,a.jsx)(u(),{src:"/planner.svg",alt:"",width:48,height:48}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-3xl font-extrabold block leading-snug",children:"Event\xa0Planner"}),(0,a.jsx)("span",{className:"".concat(p.subtleTextOnBg," text-sm block leading-none"),children:"Idle\xa0Apocalypse: Lost\xa0in\xa0Time\xa0"})]})]})}function page_Modals(e){let{modals:t}=e;return(0,a.jsx)(a.Fragment,{children:t.save.isVisible?(0,a.jsx)(ModalSave,{closeModal:t.save.closeModal,saveInputs:t.save.action,convertToKeyName:t.save.data.convertToKeyName}):t.load.isVisible?(0,a.jsx)(ModalLoad,{closeModal:t.load.closeModal,loadInputs:t.load.action,loadOptions:t.load.data.loadOptions,reset:function(){t.load.data.reset(),t.gameState.data.mode.reset(),"openModal"in t.gameState&&t.gameState.openModal(null)}}):t.gameState.isVisible?(0,a.jsx)(StatusForm,{closeModal:t.gameState.closeModal,setGameState:t.gameState.action,gameState:t.gameState.data.gameState,modeKit:t.gameState.data.mode}):t.offlinePeriods.isVisible?(0,a.jsx)(OfflineForm,{closeForm:t.offlinePeriods.closeModal,idxToEdit:t.offlinePeriods.data.idxToEdit,offlinePeriod:t.offlinePeriods.data.offlinePeriod,offlinePeriods:t.offlinePeriods.data.offlinePeriods,setOfflinePeriods:t.offlinePeriods.action,gameState:t.offlinePeriods.data.gameState}):null})}}},function(e){e.O(0,[986,971,864,744],function(){return e(e.s=6435)}),_N_E=e.O()}]);